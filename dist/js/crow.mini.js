var COMPILED=false;var goog=goog||{};goog.global=this;goog.DEBUG=true;goog.LOCALE="en";goog.TRUSTED_SITE=true;goog.provide=function(name){if(!COMPILED){if(goog.isProvided_(name))throw Error('Namespace "'+name+'" already declared.');delete goog.implicitNamespaces_[name];var namespace=name;while(namespace=namespace.substring(0,namespace.lastIndexOf("."))){if(goog.getObjectByName(namespace))break;goog.implicitNamespaces_[namespace]=true}}goog.exportPath_(name)};
goog.setTestOnly=function(opt_message){if(COMPILED&&!goog.DEBUG){opt_message=opt_message||"";throw Error("Importing test-only code into non-debug environment"+opt_message?": "+opt_message:".");}};if(!COMPILED){goog.isProvided_=function(name){return!goog.implicitNamespaces_[name]&&!!goog.getObjectByName(name)};goog.implicitNamespaces_={}}
goog.exportPath_=function(name,opt_object,opt_objectToExportTo){var parts=name.split(".");var cur=opt_objectToExportTo||goog.global;if(!(parts[0]in cur)&&cur.execScript)cur.execScript("var "+parts[0]);for(var part;parts.length&&(part=parts.shift());)if(!parts.length&&goog.isDef(opt_object))cur[part]=opt_object;else if(cur[part])cur=cur[part];else cur=cur[part]={}};
goog.getObjectByName=function(name,opt_obj){var parts=name.split(".");var cur=opt_obj||goog.global;for(var part;part=parts.shift();)if(goog.isDefAndNotNull(cur[part]))cur=cur[part];else return null;return cur};goog.globalize=function(obj,opt_global){var global=opt_global||goog.global;for(var x in obj)global[x]=obj[x]};
goog.addDependency=function(relPath,provides,requires){if(!COMPILED){var provide,require;var path=relPath.replace(/\\/g,"/");var deps=goog.dependencies_;for(var i=0;provide=provides[i];i++){deps.nameToPath[provide]=path;if(!(path in deps.pathToNames))deps.pathToNames[path]={};deps.pathToNames[path][provide]=true}for(var j=0;require=requires[j];j++){if(!(path in deps.requires))deps.requires[path]={};deps.requires[path][require]=true}}};goog.ENABLE_DEBUG_LOADER=true;
goog.require=function(name){if(!COMPILED){if(goog.isProvided_(name))return;if(goog.ENABLE_DEBUG_LOADER){var path=goog.getPathFromDeps_(name);if(path){goog.included_[path]=true;goog.writeScripts_();return}}var errorMessage="goog.require could not find: "+name;if(goog.global.console)goog.global.console["error"](errorMessage);throw Error(errorMessage);}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};
goog.identityFunction=function(opt_returnValue,var_args){return opt_returnValue};goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(ctor){ctor.getInstance=function(){if(ctor.instance_)return ctor.instance_;if(goog.DEBUG)goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=ctor;return ctor.instance_=new ctor}};goog.instantiatedSingletons_=[];
if(!COMPILED&&goog.ENABLE_DEBUG_LOADER){goog.included_={};goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}};goog.inHtmlDocument_=function(){var doc=goog.global.document;return typeof doc!="undefined"&&"write"in doc};goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH){goog.basePath=goog.global.CLOSURE_BASE_PATH;return}else if(!goog.inHtmlDocument_())return;var doc=goog.global.document;var scripts=doc.getElementsByTagName("script");for(var i=scripts.length-
1;i>=0;--i){var src=scripts[i].src;var qmark=src.lastIndexOf("?");var l=qmark==-1?src.length:qmark;if(src.substr(l-7,7)=="base.js"){goog.basePath=src.substr(0,l-7);return}}};goog.importScript_=function(src){var importScript=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;if(!goog.dependencies_.written[src]&&importScript(src))goog.dependencies_.written[src]=true};goog.writeScriptTag_=function(src){if(goog.inHtmlDocument_()){var doc=goog.global.document;if(doc.readyState=="complete"){var isDeps=
/\bdeps.js$/.test(src);if(isDeps)return false;else throw Error('Cannot write "'+src+'" after document load');}doc.write('<script type="text/javascript" src="'+src+'"></'+"script>");return true}else return false};goog.writeScripts_=function(){var scripts=[];var seenScript={};var deps=goog.dependencies_;function visitNode(path){if(path in deps.written)return;if(path in deps.visited){if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}return}deps.visited[path]=true;if(path in deps.requires)for(var requireName in deps.requires[path])if(!goog.isProvided_(requireName))if(requireName in
deps.nameToPath)visitNode(deps.nameToPath[requireName]);else throw Error("Undefined nameToPath for "+requireName);if(!(path in seenScript)){seenScript[path]=true;scripts.push(path)}}for(var path in goog.included_)if(!deps.written[path])visitNode(path);for(var i=0;i<scripts.length;i++)if(scripts[i])goog.importScript_(goog.basePath+scripts[i]);else throw Error("Undefined script input");};goog.getPathFromDeps_=function(rule){if(rule in goog.dependencies_.nameToPath)return goog.dependencies_.nameToPath[rule];
else return null};goog.findBasePath_();if(!goog.global.CLOSURE_NO_DEPS)goog.importScript_(goog.basePath+"deps.js")}
goog.typeOf=function(value){var s=typeof value;if(s=="object")if(value){if(value instanceof Array)return"array";else if(value instanceof Object)return s;var className=Object.prototype.toString.call((value));if(className=="[object Window]")return"object";if(className=="[object Array]"||typeof value.length=="number"&&typeof value.splice!="undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("splice"))return"array";if(className=="[object Function]"||typeof value.call!=
"undefined"&&typeof value.propertyIsEnumerable!="undefined"&&!value.propertyIsEnumerable("call"))return"function"}else return"null";else if(s=="function"&&typeof value.call=="undefined")return"object";return s};goog.isDef=function(val){return val!==undefined};goog.isNull=function(val){return val===null};goog.isDefAndNotNull=function(val){return val!=null};goog.isArray=function(val){return goog.typeOf(val)=="array"};
goog.isArrayLike=function(val){var type=goog.typeOf(val);return type=="array"||type=="object"&&typeof val.length=="number"};goog.isDateLike=function(val){return goog.isObject(val)&&typeof val.getFullYear=="function"};goog.isString=function(val){return typeof val=="string"};goog.isBoolean=function(val){return typeof val=="boolean"};goog.isNumber=function(val){return typeof val=="number"};goog.isFunction=function(val){return goog.typeOf(val)=="function"};
goog.isObject=function(val){var type=typeof val;return type=="object"&&val!=null||type=="function"};goog.getUid=function(obj){return obj[goog.UID_PROPERTY_]||(obj[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.removeUid=function(obj){if("removeAttribute"in obj)obj.removeAttribute(goog.UID_PROPERTY_);try{delete obj[goog.UID_PROPERTY_]}catch(ex){}};goog.UID_PROPERTY_="closure_uid_"+(Math.random()*1E9>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;
goog.cloneObject=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(obj.clone)return obj.clone();var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.cloneObject(obj[key]);return clone}return obj};goog.bindNative_=function(fn,selfObj,var_args){return(fn.call.apply(fn.bind,arguments))};
goog.bindJs_=function(fn,selfObj,var_args){if(!fn)throw new Error;if(arguments.length>2){var boundArgs=Array.prototype.slice.call(arguments,2);return function(){var newArgs=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(newArgs,boundArgs);return fn.apply(selfObj,newArgs)}}else return function(){return fn.apply(selfObj,arguments)}};
goog.bind=function(fn,selfObj,var_args){if(Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1)goog.bind=goog.bindNative_;else goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(fn,var_args){var args=Array.prototype.slice.call(arguments,1);return function(){var newArgs=Array.prototype.slice.call(arguments);newArgs.unshift.apply(newArgs,args);return fn.apply(this,newArgs)}};
goog.mixin=function(target,source){for(var x in source)target[x]=source[x]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(script){if(goog.global.execScript)goog.global.execScript(script,"JavaScript");else if(goog.global.eval){if(goog.evalWorksForGlobals_==null){goog.global.eval("var _et_ = 1;");if(typeof goog.global["_et_"]!="undefined"){delete goog.global["_et_"];goog.evalWorksForGlobals_=true}else goog.evalWorksForGlobals_=false}if(goog.evalWorksForGlobals_)goog.global.eval(script);else{var doc=goog.global.document;var scriptElt=doc.createElement("script");scriptElt.type="text/javascript";
scriptElt.defer=false;scriptElt.appendChild(doc.createTextNode(script));doc.body.appendChild(scriptElt);doc.body.removeChild(scriptElt)}}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;
goog.getCssName=function(className,opt_modifier){var getMapping=function(cssName){return goog.cssNameMapping_[cssName]||cssName};var renameByParts=function(cssName){var parts=cssName.split("-");var mapped=[];for(var i=0;i<parts.length;i++)mapped.push(getMapping(parts[i]));return mapped.join("-")};var rename;if(goog.cssNameMapping_)rename=goog.cssNameMappingStyle_=="BY_WHOLE"?getMapping:renameByParts;else rename=function(a){return a};if(opt_modifier)return className+"-"+rename(opt_modifier);else return rename(className)};
goog.setCssNameMapping=function(mapping,opt_style){goog.cssNameMapping_=mapping;goog.cssNameMappingStyle_=opt_style};goog.global.CLOSURE_CSS_NAME_MAPPING;if(!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING)goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING;goog.getMsg=function(str,opt_values){var values=opt_values||{};for(var key in values){var value=(""+values[key]).replace(/\$/g,"$$$$");str=str.replace(new RegExp("\\{\\$"+key+"\\}","gi"),value)}return str};
goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(publicPath,object,opt_objectToExportTo){goog.exportPath_(publicPath,object,opt_objectToExportTo)};goog.exportProperty=function(object,publicName,symbol){object[publicName]=symbol};goog.inherits=function(childCtor,parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;childCtor.superClass_=parentCtor.prototype;childCtor.prototype=new tempCtor;childCtor.prototype.constructor=childCtor};
goog.base=function(me,opt_methodName,var_args){var caller=arguments.callee.caller;if(caller.superClass_)return caller.superClass_.constructor.apply(me,Array.prototype.slice.call(arguments,1));var args=Array.prototype.slice.call(arguments,2);var foundCaller=false;for(var ctor=me.constructor;ctor;ctor=ctor.superClass_&&ctor.superClass_.constructor)if(ctor.prototype[opt_methodName]===caller)foundCaller=true;else if(foundCaller)return ctor.prototype[opt_methodName].apply(me,args);if(me[opt_methodName]===
caller)return me.constructor.prototype[opt_methodName].apply(me,args);else throw Error("goog.base called from a method of one name "+"to a method of a different name");};goog.scope=function(fn){fn.call(goog.global)};goog.provide("crow.util.MonkeyPatches");if(!Array.prototype.indexOf)Array.prototype.indexOf=function(elt){var len=this.length>>>0;var from=Number(arguments[1])||0;from=from<0?Math.ceil(from):Math.floor(from);if(from<0)from+=len;for(;from<len;from++)if(from in this&&this[from]===elt)return from;return-1};if(!Array.prototype.shuffle)Array.prototype.shuffle=function(){var v=this.concat();for(var j,x,i=v.length;i;j=parseInt(Math.random()*i),x=v[--i],v[i]=v[j],v[j]=x);return v};goog.provide("crow.Logger");
(function(){var globalScope=goog.global;var LOG_LEVEL={"error":1,"warn":2,"info":3,"debug":4,"off":-Infinity};var appender=globalScope.console?console:{};var GLOBAL_LOG_LEVEL=LOG_LEVEL["warn"];crow.Logger=function(klass){this.klass=klass};crow.Logger.prototype.getLogLevel=function(){if(typeof this.klass.LOG_LEVEL!=="undefined")return this.klass.LOG_LEVEL;else return GLOBAL_LOG_LEVEL};crow.Logger.prototype.error=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Error: "+args[0];
if(appender&&appender.error&&this.getLogLevel()>=1)appender.error.apply(appender,args)};crow.Logger.prototype.warn=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Warning: "+args[0];if(appender&&appender.warn&&this.getLogLevel()>=2)appender.warn.apply(appender,args)};crow.Logger.prototype.info=function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Info: "+args[0];if(appender&&appender.info&&this.getLogLevel()>=3)appender.info.apply(appender,args)};crow.Logger.prototype.debug=
function(){var args=Array.prototype.slice.call(arguments,0);args[0]="Crow Debug: "+args[0];if(appender&&appender.debug&&this.getLogLevel()>=4)appender.debug.apply(appender,args)};crow.Logger.prototype.setLevel=function(level){return crow.Logger.setLevel(level,this.klass)};crow.Logger.setLevel=function(level,klass){var newLevel=LOG_LEVEL[level.toLowerCase()];if(typeof newLevel!=="number")throw new Error("Invalid log level: "+level);if(klass)klass.LOG_LEVEL=newLevel;else GLOBAL_LOG_LEVEL=newLevel};
crow.Logger.setAppender=function(newAppender){appender=newAppender}})();goog.provide("crow.util.Assert");crow.assert=function(bool,msg){if(!bool)throw new Error(msg);};crow.assert.InvalidArgumentType=function(expectedType){return"Invalid argument type, expected "+expectedType};crow.assert.IncorrectArgumentCount=function(actualCount,expectedCount){return"Incorrect argument count, got "+actualCount+" but expected "+expectedCount};crow.assert.IndexOutBounds=function(number){return"Index out of bounds (<0 or >length), was "+number};
crow.assert.AbstractMethod=function(methodName){return"Method "+methodName+" is abstract; must be overridden"};crow.assert.IllegalMethodCall=function(methodName,msg){return"Method `"+methodName+"` cannot be called here: "+msg};goog.provide("crow.structs.BucketPriorityQueue");crow.structs.BucketPriorityQueue=function(key_comparator){this.arr=[];this.length=0;if(key_comparator)this.key_comparator=key_comparator;else this.key_comparator=crow.structs.BucketPriorityQueue.DEFAULT_KEY_COMPARATOR};crow.structs.BucketPriorityQueue.DEFAULT_KEY_COMPARATOR=function(k1,k2){if(k1<k2)return-1;if(k1>k2)return 1;return 0};crow.structs.BucketPriorityQueue.REVERSE_KEY_COMPARATOR=function(k2,k1){if(k1<k2)return-1;if(k1>k2)return 1;return 0};
crow.structs.BucketPriorityQueue.prototype.enqueue=function(key,value){this.findBucket(key,true).push(value);this.length++};crow.structs.BucketPriorityQueue.prototype.dequeue=function(){var element;if(this.length){var bucket=this.arr[0];element=bucket.shift();if(!bucket.length)this.arr.shift();this.length--}return element};
crow.structs.BucketPriorityQueue.prototype.contains=function(value,key_hint){if(key_hint)throw new Error("not implemented yet");else for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value)return true}}return false};
crow.structs.BucketPriorityQueue.prototype.getPriority=function(value){for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value)return bucket.key}}return null};
crow.structs.BucketPriorityQueue.prototype.remove=function(value,key_hint){if(key_hint)throw new Error("not implemented yet");else{for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];for(var j=0;j<bucket.length;j++){var bucketValue=bucket[j];if(bucketValue==value){bucket.splice(j,1);if(!bucket.length)this.arr.splice(i,1);this.length--;return bucketValue}}}return undefined}};crow.structs.BucketPriorityQueue.prototype.peek=function(){if(this.length)return this.arr[0][0]};
crow.structs.BucketPriorityQueue.prototype.peekKey=function(){if(this.length)return this.arr[0].key};crow.structs.BucketPriorityQueue.prototype.each=function(callback){for(var i=0;i<this.arr.length;i++){var bucket=this.arr[i];if(bucket)for(var j=0;j<bucket.length;j++)callback(bucket[j],i)}};
crow.structs.BucketPriorityQueue.prototype.findBucket=function(key,createIfNotFound){var bucket;var kc=this.key_comparator;var lowerBound=0,upperBound=this.arr.length-1;var min=0,max=this.arr.length-1,mid,comp;while(min<=max){mid=min+Math.floor((max-min)/2);var currentBucket=this.arr[mid];comp=kc(currentBucket.key,key);if(comp<0)min=mid+1;else if(comp>0)max=mid-1;else{bucket=currentBucket;break}}if(!bucket&&createIfNotFound){bucket=[];bucket.key=key;var inserted=false;for(var i=mid;i<this.arr.length&&
!inserted;i++)if(kc(this.arr[i].key,key)>0){this.arr.splice(i,0,bucket);inserted=true}if(!inserted)this.arr.push(bucket)}return bucket};goog.provide("crow.Algorithm");goog.require("crow.structs.BucketPriorityQueue");crow.Algorithm=function(){};crow.Algorithm.wrapperNodeGetterTemplate=function(klass){return function(node){if(node instanceof klass)return node;var w=this.wrapperNode.get(node);if(w)return w;w=new klass(node);w.algorithm=this;this.wrapperNode.set(node,w);return w}};
crow.Algorithm.prototype._invalidatePoint=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;for(var i=0;i<path.nodes.length;i++){var n=path.nodes[i];if(n.x==x&&n.y==y){path.nodes=path.nodes.slice(0,1);path.end=null;path.found=false;break}}};
crow.Algorithm.prototype._invalidateRegion=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;var x2=x+invalidationEvent.dx,y2=y+invalidationEvent.dy;for(var i=0;i<path.nodes.length;i++){var n=path.nodes[i];var nx=n.x,ny=n.y;if(nx>=x&&ny>=y&&nx<x2&&ny<y2){path.nodes=path.nodes.slice(0,1);path.end=null;path.found=false;break}}};
crow.Algorithm.prototype.continueCalculating=function(path,count){var lastNode=path.nodes[path.nodes.length-1];if(!lastNode)lastNode=path.start;var opts={};if(count)opts.limit=count;if(path.actor)opts.actor=path.actor;var continuedPath=this.findPath(lastNode,path.goal,opts);path.nodes=path.nodes.concat(continuedPath.nodes.slice(1)),path.found=continuedPath.found;return path.found};
crow.Algorithm.NodeMap=function(defaultValue){var map={};this.get=function(node){var val=map[node.id];return typeof val!=="undefined"?val:defaultValue};this.set=function(node,val){map[node.id]=val}};crow.Algorithm.PriorityQueue=function(){throw new Error("A PriorityQueue class is required, but none found!");};crow.Algorithm.initializeDataStructures=function(){crow.Algorithm.PriorityQueue=crow.structs.BucketPriorityQueue;crow.Algorithm.initializeDataStructures=function(){}};goog.provide("goog.disposable.IDisposable");goog.disposable.IDisposable=function(){};goog.disposable.IDisposable.prototype.dispose;goog.disposable.IDisposable.prototype.isDisposed;goog.provide("goog.Disposable");goog.provide("goog.dispose");goog.require("goog.disposable.IDisposable");goog.Disposable=function(){if(goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF){this.creationStack=(new Error).stack;goog.Disposable.instances_[goog.getUid(this)]=this}};goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2};goog.Disposable.MONITORING_MODE=0;goog.Disposable.instances_={};
goog.Disposable.getUndisposedObjects=function(){var ret=[];for(var id in goog.Disposable.instances_)if(goog.Disposable.instances_.hasOwnProperty(id))ret.push(goog.Disposable.instances_[Number(id)]);return ret};goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}};goog.Disposable.prototype.disposed_=false;goog.Disposable.prototype.onDisposeCallbacks_;goog.Disposable.prototype.creationStack;goog.Disposable.prototype.isDisposed=function(){return this.disposed_};
goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;
goog.Disposable.prototype.dispose=function(){if(!this.disposed_){this.disposed_=true;this.disposeInternal();if(goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF){var uid=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(uid))throw Error(this+" did not call the goog.Disposable base "+"constructor or was disposed of after a clearUndisposedObjects "+"call");delete goog.Disposable.instances_[uid]}}};
goog.Disposable.prototype.registerDisposable=function(disposable){this.addOnDisposeCallback(goog.partial(goog.dispose,disposable))};goog.Disposable.prototype.addOnDisposeCallback=function(callback,opt_scope){if(!this.onDisposeCallbacks_)this.onDisposeCallbacks_=[];this.onDisposeCallbacks_.push(goog.bind(callback,opt_scope))};goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)while(this.onDisposeCallbacks_.length)this.onDisposeCallbacks_.shift()()};
goog.Disposable.isDisposed=function(obj){if(obj&&typeof obj.isDisposed=="function")return obj.isDisposed();return false};goog.dispose=function(obj){if(obj&&typeof obj.dispose=="function")obj.dispose()};goog.disposeAll=function(var_args){for(var i=0,len=arguments.length;i<len;++i){var disposable=arguments[i];if(goog.isArrayLike(disposable))goog.disposeAll.apply(null,disposable);else goog.dispose(disposable)}};goog.provide("goog.debug.Error");goog.debug.Error=function(opt_msg){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else this.stack=(new Error).stack||"";if(opt_msg)this.message=String(opt_msg)};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.provide("goog.string");goog.provide("goog.string.Unicode");goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(str,prefix){return str.lastIndexOf(prefix,0)==0};goog.string.endsWith=function(str,suffix){var l=str.length-suffix.length;return l>=0&&str.indexOf(suffix,l)==l};goog.string.caseInsensitiveStartsWith=function(str,prefix){return goog.string.caseInsensitiveCompare(prefix,str.substr(0,prefix.length))==0};
goog.string.caseInsensitiveEndsWith=function(str,suffix){return goog.string.caseInsensitiveCompare(suffix,str.substr(str.length-suffix.length,suffix.length))==0};goog.string.subs=function(str,var_args){for(var i=1;i<arguments.length;i++){var replacement=String(arguments[i]).replace(/\$/g,"$$$$");str=str.replace(/\%s/,replacement)}return str};goog.string.collapseWhitespace=function(str){return str.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};goog.string.isEmpty=function(str){return/^[\s\xa0]*$/.test(str)};
goog.string.isEmptySafe=function(str){return goog.string.isEmpty(goog.string.makeSafe(str))};goog.string.isBreakingWhitespace=function(str){return!/[^\t\n\r ]/.test(str)};goog.string.isAlpha=function(str){return!/[^a-zA-Z]/.test(str)};goog.string.isNumeric=function(str){return!/[^0-9]/.test(str)};goog.string.isAlphaNumeric=function(str){return!/[^a-zA-Z0-9]/.test(str)};goog.string.isSpace=function(ch){return ch==" "};
goog.string.isUnicodeChar=function(ch){return ch.length==1&&ch>=" "&&ch<="~"||ch>="\u0080"&&ch<="\ufffd"};goog.string.stripNewlines=function(str){return str.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(str){return str.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(str){return str.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(str){return str.replace(/\xa0|[ \t]+/g," ")};
goog.string.collapseBreakingSpaces=function(str){return str.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=function(str){return str.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(str){return str.replace(/^[\s\xa0]+/,"")};goog.string.trimRight=function(str){return str.replace(/[\s\xa0]+$/,"")};
goog.string.caseInsensitiveCompare=function(str1,str2){var test1=String(str1).toLowerCase();var test2=String(str2).toLowerCase();if(test1<test2)return-1;else if(test1==test2)return 0;else return 1};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;
goog.string.numerateCompare=function(str1,str2){if(str1==str2)return 0;if(!str1)return-1;if(!str2)return 1;var tokens1=str1.toLowerCase().match(goog.string.numerateCompareRegExp_);var tokens2=str2.toLowerCase().match(goog.string.numerateCompareRegExp_);var count=Math.min(tokens1.length,tokens2.length);for(var i=0;i<count;i++){var a=tokens1[i];var b=tokens2[i];if(a!=b){var num1=parseInt(a,10);if(!isNaN(num1)){var num2=parseInt(b,10);if(!isNaN(num2)&&num1-num2)return num1-num2}return a<b?-1:1}}if(tokens1.length!=
tokens2.length)return tokens1.length-tokens2.length;return str1<str2?-1:1};goog.string.urlEncode=function(str){return encodeURIComponent(String(str))};goog.string.urlDecode=function(str){return decodeURIComponent(str.replace(/\+/g," "))};goog.string.newLineToBr=function(str,opt_xml){return str.replace(/(\r\n|\r|\n)/g,opt_xml?"<br />":"<br>")};
goog.string.htmlEscape=function(str,opt_isLikelyToContainHtmlChars){if(opt_isLikelyToContainHtmlChars)return str.replace(goog.string.amperRe_,"&amp;").replace(goog.string.ltRe_,"&lt;").replace(goog.string.gtRe_,"&gt;").replace(goog.string.quotRe_,"&quot;");else{if(!goog.string.allRe_.test(str))return str;if(str.indexOf("&")!=-1)str=str.replace(goog.string.amperRe_,"&amp;");if(str.indexOf("<")!=-1)str=str.replace(goog.string.ltRe_,"&lt;");if(str.indexOf(">")!=-1)str=str.replace(goog.string.gtRe_,"&gt;");
if(str.indexOf('"')!=-1)str=str.replace(goog.string.quotRe_,"&quot;");return str}};goog.string.amperRe_=/&/g;goog.string.ltRe_=/</g;goog.string.gtRe_=/>/g;goog.string.quotRe_=/\"/g;goog.string.allRe_=/[&<>\"]/;goog.string.unescapeEntities=function(str){if(goog.string.contains(str,"&"))if("document"in goog.global)return goog.string.unescapeEntitiesUsingDom_(str);else return goog.string.unescapePureXmlEntities_(str);return str};
goog.string.unescapeEntitiesUsingDom_=function(str){var seen={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};var div=document.createElement("div");return str.replace(goog.string.HTML_ENTITY_PATTERN_,function(s,entity){var value=seen[s];if(value)return value;if(entity.charAt(0)=="#"){var n=Number("0"+entity.substr(1));if(!isNaN(n))value=String.fromCharCode(n)}if(!value){div.innerHTML=s+" ";value=div.firstChild.nodeValue.slice(0,-1)}return seen[s]=value})};
goog.string.unescapePureXmlEntities_=function(str){return str.replace(/&([^;]+);/g,function(s,entity){switch(entity){case "amp":return"&";case "lt":return"<";case "gt":return">";case "quot":return'"';default:if(entity.charAt(0)=="#"){var n=Number("0"+entity.substr(1));if(!isNaN(n))return String.fromCharCode(n)}return s}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(str,opt_xml){return goog.string.newLineToBr(str.replace(/  /g," &#160;"),opt_xml)};
goog.string.stripQuotes=function(str,quoteChars){var length=quoteChars.length;for(var i=0;i<length;i++){var quoteChar=length==1?quoteChars:quoteChars.charAt(i);if(str.charAt(0)==quoteChar&&str.charAt(str.length-1)==quoteChar)return str.substring(1,str.length-1)}return str};
goog.string.truncate=function(str,chars,opt_protectEscapedCharacters){if(opt_protectEscapedCharacters)str=goog.string.unescapeEntities(str);if(str.length>chars)str=str.substring(0,chars-3)+"...";if(opt_protectEscapedCharacters)str=goog.string.htmlEscape(str);return str};
goog.string.truncateMiddle=function(str,chars,opt_protectEscapedCharacters,opt_trailingChars){if(opt_protectEscapedCharacters)str=goog.string.unescapeEntities(str);if(opt_trailingChars&&str.length>chars){if(opt_trailingChars>chars)opt_trailingChars=chars;var endPoint=str.length-opt_trailingChars;var startPoint=chars-opt_trailingChars;str=str.substring(0,startPoint)+"..."+str.substring(endPoint)}else if(str.length>chars){var half=Math.floor(chars/2);var endPos=str.length-half;half+=chars%2;str=str.substring(0,
half)+"..."+str.substring(endPos)}if(opt_protectEscapedCharacters)str=goog.string.htmlEscape(str);return str};goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};
goog.string.quote=function(s){s=String(s);if(s.quote)return s.quote();else{var sb=['"'];for(var i=0;i<s.length;i++){var ch=s.charAt(i);var cc=ch.charCodeAt(0);sb[i+1]=goog.string.specialEscapeChars_[ch]||(cc>31&&cc<127?ch:goog.string.escapeChar(ch))}sb.push('"');return sb.join("")}};goog.string.escapeString=function(str){var sb=[];for(var i=0;i<str.length;i++)sb[i]=goog.string.escapeChar(str.charAt(i));return sb.join("")};
goog.string.escapeChar=function(c){if(c in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[c];if(c in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[c]=goog.string.specialEscapeChars_[c];var rv=c;var cc=c.charCodeAt(0);if(cc>31&&cc<127)rv=c;else{if(cc<256){rv="\\x";if(cc<16||cc>256)rv+="0"}else{rv="\\u";if(cc<4096)rv+="0"}rv+=cc.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[c]=rv};
goog.string.toMap=function(s){var rv={};for(var i=0;i<s.length;i++)rv[s.charAt(i)]=true;return rv};goog.string.contains=function(s,ss){return s.indexOf(ss)!=-1};goog.string.countOf=function(s,ss){return s&&ss?s.split(ss).length-1:0};goog.string.removeAt=function(s,index,stringLength){var resultStr=s;if(index>=0&&index<s.length&&stringLength>0)resultStr=s.substr(0,index)+s.substr(index+stringLength,s.length-index-stringLength);return resultStr};
goog.string.remove=function(s,ss){var re=new RegExp(goog.string.regExpEscape(ss),"");return s.replace(re,"")};goog.string.removeAll=function(s,ss){var re=new RegExp(goog.string.regExpEscape(ss),"g");return s.replace(re,"")};goog.string.regExpEscape=function(s){return String(s).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(string,length){return(new Array(length+1)).join(string)};
goog.string.padNumber=function(num,length,opt_precision){var s=goog.isDef(opt_precision)?num.toFixed(opt_precision):String(num);var index=s.indexOf(".");if(index==-1)index=s.length;return goog.string.repeat("0",Math.max(0,length-index))+s};goog.string.makeSafe=function(obj){return obj==null?"":String(obj)};goog.string.buildString=function(var_args){return Array.prototype.join.call(arguments,"")};
goog.string.getRandomString=function(){var x=2147483648;return Math.floor(Math.random()*x).toString(36)+Math.abs(Math.floor(Math.random()*x)^goog.now()).toString(36)};
goog.string.compareVersions=function(version1,version2){var order=0;var v1Subs=goog.string.trim(String(version1)).split(".");var v2Subs=goog.string.trim(String(version2)).split(".");var subCount=Math.max(v1Subs.length,v2Subs.length);for(var subIdx=0;order==0&&subIdx<subCount;subIdx++){var v1Sub=v1Subs[subIdx]||"";var v2Sub=v2Subs[subIdx]||"";var v1CompParser=new RegExp("(\\d*)(\\D*)","g");var v2CompParser=new RegExp("(\\d*)(\\D*)","g");do{var v1Comp=v1CompParser.exec(v1Sub)||["","",""];var v2Comp=
v2CompParser.exec(v2Sub)||["","",""];if(v1Comp[0].length==0&&v2Comp[0].length==0)break;var v1CompNum=v1Comp[1].length==0?0:parseInt(v1Comp[1],10);var v2CompNum=v2Comp[1].length==0?0:parseInt(v2Comp[1],10);order=goog.string.compareElements_(v1CompNum,v2CompNum)||goog.string.compareElements_(v1Comp[2].length==0,v2Comp[2].length==0)||goog.string.compareElements_(v1Comp[2],v2Comp[2])}while(order==0)}return order};
goog.string.compareElements_=function(left,right){if(left<right)return-1;else if(left>right)return 1;return 0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(str){var result=0;for(var i=0;i<str.length;++i){result=31*result+str.charCodeAt(i);result%=goog.string.HASHCODE_MAX_}return result};goog.string.uniqueStringCounter_=Math.random()*2147483648|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};
goog.string.toNumber=function(str){var num=Number(str);if(num==0&&goog.string.isEmpty(str))return NaN;return num};goog.string.toCamelCase=function(str){return String(str).replace(/\-([a-z])/g,function(all,match){return match.toUpperCase()})};goog.string.toSelectorCase=function(str){return String(str).replace(/([A-Z])/g,"-$1").toLowerCase()};
goog.string.toTitleCase=function(str,opt_delimiters){var delimiters=goog.isString(opt_delimiters)?goog.string.regExpEscape(opt_delimiters):"\\s";delimiters=delimiters?"|["+delimiters+"]+":"";var regexp=new RegExp("(^"+delimiters+")([a-z])","g");return str.replace(regexp,function(all,p1,p2){return p1+p2.toUpperCase()})};goog.string.parseInt=function(value){if(isFinite(value))value=String(value);if(goog.isString(value))return/^\s*-?0x/i.test(value)?parseInt(value,16):parseInt(value,10);return NaN};goog.provide("goog.asserts");goog.provide("goog.asserts.AssertionError");goog.require("goog.debug.Error");goog.require("goog.string");goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(messagePattern,messageArgs){messageArgs.unshift(messagePattern);goog.debug.Error.call(this,goog.string.subs.apply(null,messageArgs));messageArgs.shift();this.messagePattern=messagePattern};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);
goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.doAssertFailure_=function(defaultMessage,defaultArgs,givenMessage,givenArgs){var message="Assertion failed";if(givenMessage){message+=": "+givenMessage;var args=givenArgs}else if(defaultMessage){message+=": "+defaultMessage;args=defaultArgs}throw new goog.asserts.AssertionError(""+message,args||[]);};
goog.asserts.assert=function(condition,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!condition)goog.asserts.doAssertFailure_("",null,opt_message,Array.prototype.slice.call(arguments,2));return condition};goog.asserts.fail=function(opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS)throw new goog.asserts.AssertionError("Failure"+(opt_message?": "+opt_message:""),Array.prototype.slice.call(arguments,1));};
goog.asserts.assertNumber=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(value))goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertString=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isString(value))goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertFunction=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(value))goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertObject=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isObject(value))goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertArray=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isArray(value))goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertBoolean=function(value,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(value))goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(value),value],opt_message,Array.prototype.slice.call(arguments,2));return(value)};
goog.asserts.assertInstanceof=function(value,type,opt_message,var_args){if(goog.asserts.ENABLE_ASSERTS&&!(value instanceof type))goog.asserts.doAssertFailure_("instanceof check failed.",null,opt_message,Array.prototype.slice.call(arguments,3));return(value)};goog.provide("goog.array");goog.provide("goog.array.ArrayLike");goog.require("goog.asserts");goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE;goog.array.ArrayLike;goog.array.peek=function(array){return array[array.length-1]};goog.array.ARRAY_PROTOTYPE_=Array.prototype;
goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.indexOf?function(arr,obj,opt_fromIndex){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(arr,obj,opt_fromIndex)}:function(arr,obj,opt_fromIndex){var fromIndex=opt_fromIndex==null?0:opt_fromIndex<0?Math.max(0,arr.length+opt_fromIndex):opt_fromIndex;if(goog.isString(arr)){if(!goog.isString(obj)||obj.length!=1)return-1;return arr.indexOf(obj,fromIndex)}for(var i=fromIndex;i<arr.length;i++)if(i in
arr&&arr[i]===obj)return i;return-1};
goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.lastIndexOf?function(arr,obj,opt_fromIndex){goog.asserts.assert(arr.length!=null);var fromIndex=opt_fromIndex==null?arr.length-1:opt_fromIndex;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(arr,obj,fromIndex)}:function(arr,obj,opt_fromIndex){var fromIndex=opt_fromIndex==null?arr.length-1:opt_fromIndex;if(fromIndex<0)fromIndex=Math.max(0,arr.length+fromIndex);if(goog.isString(arr)){if(!goog.isString(obj)||obj.length!=
1)return-1;return arr.lastIndexOf(obj,fromIndex)}for(var i=fromIndex;i>=0;i--)if(i in arr&&arr[i]===obj)return i;return-1};goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.forEach?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);goog.array.ARRAY_PROTOTYPE_.forEach.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2)f.call(opt_obj,arr2[i],i,arr)};
goog.array.forEachRight=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=l-1;i>=0;--i)if(i in arr2)f.call(opt_obj,arr2[i],i,arr)};
goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.filter?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.filter.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var res=[];var resLength=0;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2){var val=arr2[i];if(f.call(opt_obj,val,i,arr))res[resLength++]=val}return res};
goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.map?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.map.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var res=new Array(l);var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2)res[i]=f.call(opt_obj,arr2[i],i,arr);return res};
goog.array.reduce=function(arr,f,val,opt_obj){if(arr.reduce)if(opt_obj)return arr.reduce(goog.bind(f,opt_obj),val);else return arr.reduce(f,val);var rval=val;goog.array.forEach(arr,function(val,index){rval=f.call(opt_obj,rval,val,index,arr)});return rval};
goog.array.reduceRight=function(arr,f,val,opt_obj){if(arr.reduceRight)if(opt_obj)return arr.reduceRight(goog.bind(f,opt_obj),val);else return arr.reduceRight(f,val);var rval=val;goog.array.forEachRight(arr,function(val,index){rval=f.call(opt_obj,rval,val,index,arr)});return rval};
goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.some?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.some.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return true;return false};
goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&goog.array.ARRAY_PROTOTYPE_.every?function(arr,f,opt_obj){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.every.call(arr,f,opt_obj)}:function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&!f.call(opt_obj,arr2[i],i,arr))return false;return true};
goog.array.count=function(arr,f,opt_obj){var count=0;goog.array.forEach(arr,function(element,index,arr){if(f.call(opt_obj,element,index,arr))++count},opt_obj);return count};goog.array.find=function(arr,f,opt_obj){var i=goog.array.findIndex(arr,f,opt_obj);return i<0?null:goog.isString(arr)?arr.charAt(i):arr[i]};goog.array.findIndex=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=0;i<l;i++)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return i;return-1};
goog.array.findRight=function(arr,f,opt_obj){var i=goog.array.findIndexRight(arr,f,opt_obj);return i<0?null:goog.isString(arr)?arr.charAt(i):arr[i]};goog.array.findIndexRight=function(arr,f,opt_obj){var l=arr.length;var arr2=goog.isString(arr)?arr.split(""):arr;for(var i=l-1;i>=0;i--)if(i in arr2&&f.call(opt_obj,arr2[i],i,arr))return i;return-1};goog.array.contains=function(arr,obj){return goog.array.indexOf(arr,obj)>=0};goog.array.isEmpty=function(arr){return arr.length==0};
goog.array.clear=function(arr){if(!goog.isArray(arr))for(var i=arr.length-1;i>=0;i--)delete arr[i];arr.length=0};goog.array.insert=function(arr,obj){if(!goog.array.contains(arr,obj))arr.push(obj)};goog.array.insertAt=function(arr,obj,opt_i){goog.array.splice(arr,opt_i,0,obj)};goog.array.insertArrayAt=function(arr,elementsToAdd,opt_i){goog.partial(goog.array.splice,arr,opt_i,0).apply(null,elementsToAdd)};
goog.array.insertBefore=function(arr,obj,opt_obj2){var i;if(arguments.length==2||(i=goog.array.indexOf(arr,opt_obj2))<0)arr.push(obj);else goog.array.insertAt(arr,obj,i)};goog.array.remove=function(arr,obj){var i=goog.array.indexOf(arr,obj);var rv;if(rv=i>=0)goog.array.removeAt(arr,i);return rv};goog.array.removeAt=function(arr,i){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.call(arr,i,1).length==1};
goog.array.removeIf=function(arr,f,opt_obj){var i=goog.array.findIndex(arr,f,opt_obj);if(i>=0){goog.array.removeAt(arr,i);return true}return false};goog.array.concat=function(var_args){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.toArray=function(object){var length=object.length;if(length>0){var rv=new Array(length);for(var i=0;i<length;i++)rv[i]=object[i];return rv}return[]};goog.array.clone=goog.array.toArray;
goog.array.extend=function(arr1,var_args){for(var i=1;i<arguments.length;i++){var arr2=arguments[i];var isArrayLike;if(goog.isArray(arr2)||(isArrayLike=goog.isArrayLike(arr2))&&Object.prototype.hasOwnProperty.call(arr2,"callee"))arr1.push.apply(arr1,arr2);else if(isArrayLike){var len1=arr1.length;var len2=arr2.length;for(var j=0;j<len2;j++)arr1[len1+j]=arr2[j]}else arr1.push(arr2)}};
goog.array.splice=function(arr,index,howMany,var_args){goog.asserts.assert(arr.length!=null);return goog.array.ARRAY_PROTOTYPE_.splice.apply(arr,goog.array.slice(arguments,1))};goog.array.slice=function(arr,start,opt_end){goog.asserts.assert(arr.length!=null);if(arguments.length<=2)return goog.array.ARRAY_PROTOTYPE_.slice.call(arr,start);else return goog.array.ARRAY_PROTOTYPE_.slice.call(arr,start,opt_end)};
goog.array.removeDuplicates=function(arr,opt_rv){var returnArray=opt_rv||arr;var seen={},cursorInsert=0,cursorRead=0;while(cursorRead<arr.length){var current=arr[cursorRead++];var key=goog.isObject(current)?"o"+goog.getUid(current):(typeof current).charAt(0)+current;if(!Object.prototype.hasOwnProperty.call(seen,key)){seen[key]=true;returnArray[cursorInsert++]=current}}returnArray.length=cursorInsert};
goog.array.binarySearch=function(arr,target,opt_compareFn){return goog.array.binarySearch_(arr,opt_compareFn||goog.array.defaultCompare,false,target)};goog.array.binarySelect=function(arr,evaluator,opt_obj){return goog.array.binarySearch_(arr,evaluator,true,undefined,opt_obj)};
goog.array.binarySearch_=function(arr,compareFn,isEvaluator,opt_target,opt_selfObj){var left=0;var right=arr.length;var found;while(left<right){var middle=left+right>>1;var compareResult;if(isEvaluator)compareResult=compareFn.call(opt_selfObj,arr[middle],middle,arr);else compareResult=compareFn(opt_target,arr[middle]);if(compareResult>0)left=middle+1;else{right=middle;found=!compareResult}}return found?left:~left};
goog.array.sort=function(arr,opt_compareFn){goog.asserts.assert(arr.length!=null);goog.array.ARRAY_PROTOTYPE_.sort.call(arr,opt_compareFn||goog.array.defaultCompare)};
goog.array.stableSort=function(arr,opt_compareFn){for(var i=0;i<arr.length;i++)arr[i]={index:i,value:arr[i]};var valueCompareFn=opt_compareFn||goog.array.defaultCompare;function stableCompareFn(obj1,obj2){return valueCompareFn(obj1.value,obj2.value)||obj1.index-obj2.index}goog.array.sort(arr,stableCompareFn);for(var i=0;i<arr.length;i++)arr[i]=arr[i].value};
goog.array.sortObjectsByKey=function(arr,key,opt_compareFn){var compare=opt_compareFn||goog.array.defaultCompare;goog.array.sort(arr,function(a,b){return compare(a[key],b[key])})};goog.array.isSorted=function(arr,opt_compareFn,opt_strict){var compare=opt_compareFn||goog.array.defaultCompare;for(var i=1;i<arr.length;i++){var compareResult=compare(arr[i-1],arr[i]);if(compareResult>0||compareResult==0&&opt_strict)return false}return true};
goog.array.equals=function(arr1,arr2,opt_equalsFn){if(!goog.isArrayLike(arr1)||!goog.isArrayLike(arr2)||arr1.length!=arr2.length)return false;var l=arr1.length;var equalsFn=opt_equalsFn||goog.array.defaultCompareEquality;for(var i=0;i<l;i++)if(!equalsFn(arr1[i],arr2[i]))return false;return true};goog.array.compare=function(arr1,arr2,opt_equalsFn){return goog.array.equals(arr1,arr2,opt_equalsFn)};
goog.array.compare3=function(arr1,arr2,opt_compareFn){var compare=opt_compareFn||goog.array.defaultCompare;var l=Math.min(arr1.length,arr2.length);for(var i=0;i<l;i++){var result=compare(arr1[i],arr2[i]);if(result!=0)return result}return goog.array.defaultCompare(arr1.length,arr2.length)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};goog.array.defaultCompareEquality=function(a,b){return a===b};
goog.array.binaryInsert=function(array,value,opt_compareFn){var index=goog.array.binarySearch(array,value,opt_compareFn);if(index<0){goog.array.insertAt(array,value,-(index+1));return true}return false};goog.array.binaryRemove=function(array,value,opt_compareFn){var index=goog.array.binarySearch(array,value,opt_compareFn);return index>=0?goog.array.removeAt(array,index):false};
goog.array.bucket=function(array,sorter){var buckets={};for(var i=0;i<array.length;i++){var value=array[i];var key=sorter(value,i,array);if(goog.isDef(key)){var bucket=buckets[key]||(buckets[key]=[]);bucket.push(value)}}return buckets};goog.array.toObject=function(arr,keyFunc,opt_obj){var ret={};goog.array.forEach(arr,function(element,index){ret[keyFunc.call(opt_obj,element,index,arr)]=element});return ret};
goog.array.range=function(startOrEnd,opt_end,opt_step){var array=[];var start=0;var end=startOrEnd;var step=opt_step||1;if(opt_end!==undefined){start=startOrEnd;end=opt_end}if(step*(end-start)<0)return[];if(step>0)for(var i=start;i<end;i+=step)array.push(i);else for(var i=start;i>end;i+=step)array.push(i);return array};goog.array.repeat=function(value,n){var array=[];for(var i=0;i<n;i++)array[i]=value;return array};
goog.array.flatten=function(var_args){var result=[];for(var i=0;i<arguments.length;i++){var element=arguments[i];if(goog.isArray(element))result.push.apply(result,goog.array.flatten.apply(null,element));else result.push(element)}return result};goog.array.rotate=function(array,n){goog.asserts.assert(array.length!=null);if(array.length){n%=array.length;if(n>0)goog.array.ARRAY_PROTOTYPE_.unshift.apply(array,array.splice(-n,n));else if(n<0)goog.array.ARRAY_PROTOTYPE_.push.apply(array,array.splice(0,-n))}return array};
goog.array.zip=function(var_args){if(!arguments.length)return[];var result=[];for(var i=0;true;i++){var value=[];for(var j=0;j<arguments.length;j++){var arr=arguments[j];if(i>=arr.length)return result;value.push(arr[i])}result.push(value)}};goog.array.shuffle=function(arr,opt_randFn){var randFn=opt_randFn||Math.random;for(var i=arr.length-1;i>0;i--){var j=Math.floor(randFn()*(i+1));var tmp=arr[i];arr[i]=arr[j];arr[j]=tmp}};goog.provide("goog.debug.EntryPointMonitor");goog.provide("goog.debug.entryPointRegistry");goog.require("goog.asserts");goog.debug.EntryPointMonitor=function(){};goog.debug.EntryPointMonitor.prototype.wrap;goog.debug.EntryPointMonitor.prototype.unwrap;goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.monitors_=[];goog.debug.entryPointRegistry.monitorsMayExist_=false;
goog.debug.entryPointRegistry.register=function(callback){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=callback;if(goog.debug.entryPointRegistry.monitorsMayExist_){var monitors=goog.debug.entryPointRegistry.monitors_;for(var i=0;i<monitors.length;i++)callback(goog.bind(monitors[i].wrap,monitors[i]))}};
goog.debug.entryPointRegistry.monitorAll=function(monitor){goog.debug.entryPointRegistry.monitorsMayExist_=true;var transformer=goog.bind(monitor.wrap,monitor);for(var i=0;i<goog.debug.entryPointRegistry.refList_.length;i++)goog.debug.entryPointRegistry.refList_[i](transformer);goog.debug.entryPointRegistry.monitors_.push(monitor)};
goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(monitor){var monitors=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(monitor==monitors[monitors.length-1],"Only the most recent monitor can be unwrapped.");var transformer=goog.bind(monitor.unwrap,monitor);for(var i=0;i<goog.debug.entryPointRegistry.refList_.length;i++)goog.debug.entryPointRegistry.refList_[i](transformer);monitors.length--};goog.provide("goog.debug.errorHandlerWeakDep");goog.debug.errorHandlerWeakDep={protectEntryPoint:function(fn,opt_tracers){return fn}};goog.provide("goog.userAgent");goog.require("goog.string");goog.userAgent.ASSUME_IE=false;goog.userAgent.ASSUME_GECKO=false;goog.userAgent.ASSUME_WEBKIT=false;goog.userAgent.ASSUME_MOBILE_WEBKIT=false;goog.userAgent.ASSUME_OPERA=false;goog.userAgent.ASSUME_ANY_VERSION=false;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;
goog.userAgent.getUserAgentString=function(){return goog.global["navigator"]?goog.global["navigator"].userAgent:null};goog.userAgent.getNavigator=function(){return goog.global["navigator"]};
goog.userAgent.init_=function(){goog.userAgent.detectedOpera_=false;goog.userAgent.detectedIe_=false;goog.userAgent.detectedWebkit_=false;goog.userAgent.detectedMobile_=false;goog.userAgent.detectedGecko_=false;var ua;if(!goog.userAgent.BROWSER_KNOWN_&&(ua=goog.userAgent.getUserAgentString())){var navigator=goog.userAgent.getNavigator();goog.userAgent.detectedOpera_=ua.indexOf("Opera")==0;goog.userAgent.detectedIe_=!goog.userAgent.detectedOpera_&&ua.indexOf("MSIE")!=-1;goog.userAgent.detectedWebkit_=
!goog.userAgent.detectedOpera_&&ua.indexOf("WebKit")!=-1;goog.userAgent.detectedMobile_=goog.userAgent.detectedWebkit_&&ua.indexOf("Mobile")!=-1;goog.userAgent.detectedGecko_=!goog.userAgent.detectedOpera_&&!goog.userAgent.detectedWebkit_&&navigator.product=="Gecko"}};if(!goog.userAgent.BROWSER_KNOWN_)goog.userAgent.init_();goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.userAgent.detectedOpera_;
goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.userAgent.detectedIe_;goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.userAgent.detectedGecko_;goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.userAgent.detectedWebkit_;goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.detectedMobile_;goog.userAgent.SAFARI=goog.userAgent.WEBKIT;
goog.userAgent.determinePlatform_=function(){var navigator=goog.userAgent.getNavigator();return navigator&&navigator.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=false;goog.userAgent.ASSUME_WINDOWS=false;goog.userAgent.ASSUME_LINUX=false;goog.userAgent.ASSUME_X11=false;goog.userAgent.ASSUME_ANDROID=false;goog.userAgent.ASSUME_IPHONE=false;goog.userAgent.ASSUME_IPAD=false;
goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD;
goog.userAgent.initPlatform_=function(){goog.userAgent.detectedMac_=goog.string.contains(goog.userAgent.PLATFORM,"Mac");goog.userAgent.detectedWindows_=goog.string.contains(goog.userAgent.PLATFORM,"Win");goog.userAgent.detectedLinux_=goog.string.contains(goog.userAgent.PLATFORM,"Linux");goog.userAgent.detectedX11_=!!goog.userAgent.getNavigator()&&goog.string.contains(goog.userAgent.getNavigator()["appVersion"]||"","X11");var ua=goog.userAgent.getUserAgentString();goog.userAgent.detectedAndroid_=!!ua&&
ua.indexOf("Android")>=0;goog.userAgent.detectedIPhone_=!!ua&&ua.indexOf("iPhone")>=0;goog.userAgent.detectedIPad_=!!ua&&ua.indexOf("iPad")>=0};if(!goog.userAgent.PLATFORM_KNOWN_)goog.userAgent.initPlatform_();goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.userAgent.detectedMac_;goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.userAgent.detectedWindows_;
goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.detectedLinux_;goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.detectedX11_;goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.userAgent.detectedAndroid_;goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.userAgent.detectedIPhone_;
goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.userAgent.detectedIPad_;
goog.userAgent.determineVersion_=function(){var version="",re;if(goog.userAgent.OPERA&&goog.global["opera"]){var operaVersion=goog.global["opera"].version;version=typeof operaVersion=="function"?operaVersion():operaVersion}else{if(goog.userAgent.GECKO)re=/rv\:([^\);]+)(\)|;)/;else if(goog.userAgent.IE)re=/MSIE\s+([^\);]+)(\)|;)/;else if(goog.userAgent.WEBKIT)re=/WebKit\/(\S+)/;if(re){var arr=re.exec(goog.userAgent.getUserAgentString());version=arr?arr[1]:""}}if(goog.userAgent.IE){var docMode=goog.userAgent.getDocumentMode_();
if(docMode>parseFloat(version))return String(docMode)}return version};goog.userAgent.getDocumentMode_=function(){var doc=goog.global["document"];return doc?doc["documentMode"]:undefined};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(v1,v2){return goog.string.compareVersions(v1,v2)};goog.userAgent.isVersionCache_={};
goog.userAgent.isVersion=function(version){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionCache_[version]||(goog.userAgent.isVersionCache_[version]=goog.string.compareVersions(goog.userAgent.VERSION,version)>=0)};goog.userAgent.isDocumentMode=function(documentMode){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=documentMode};
goog.userAgent.DOCUMENT_MODE=function(){var doc=goog.global["document"];if(!doc||!goog.userAgent.IE)return undefined;var mode=goog.userAgent.getDocumentMode_();return mode||(doc["compatMode"]=="CSS1Compat"?parseInt(goog.userAgent.VERSION,10):5)}();goog.provide("goog.events.BrowserFeature");goog.require("goog.userAgent");
goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentMode(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentMode(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersion("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersion("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersion("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersion("8")||goog.userAgent.OPERA&&goog.userAgent.isVersion("9.5")||
goog.userAgent.WEBKIT&&goog.userAgent.isVersion("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersion("8")||goog.userAgent.IE&&!goog.userAgent.isVersion("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global["document"]&&document.documentElement&&"ontouchstart"in document.documentElement)||!!(goog.global["navigator"]&&goog.global["navigator"]["msMaxTouchPoints"])};goog.provide("goog.events.Event");goog.provide("goog.events.EventLike");goog.require("goog.Disposable");goog.events.EventLike;goog.events.Event=function(type,opt_target){this.type=type;this.target=opt_target;this.currentTarget=this.target};goog.events.Event.prototype.disposeInternal=function(){};goog.events.Event.prototype.dispose=function(){};goog.events.Event.prototype.propagationStopped_=false;goog.events.Event.prototype.defaultPrevented=false;goog.events.Event.prototype.returnValue_=true;
goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=true};goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=true;this.returnValue_=false};goog.events.Event.stopPropagation=function(e){e.stopPropagation()};goog.events.Event.preventDefault=function(e){e.preventDefault()};goog.provide("goog.events.EventType");goog.require("goog.userAgent");
goog.events.EventType={CLICK:"click",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",SELECTSTART:"selectstart",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",
DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONTEXTMENU:"contextmenu",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",
CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",TRANSITIONEND:goog.userAgent.WEBKIT?"webkitTransitionEnd":goog.userAgent.OPERA?"oTransitionEnd":"transitionend",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",
MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROVER:"MSPointerOver",MSPOINTEROUT:"MSPointerOut",MSPOINTERUP:"MSPointerUp",TEXTINPUT:"textinput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend"};goog.provide("goog.reflect");goog.reflect.object=function(type,object){return object};goog.reflect.sinkValue=function(x){goog.reflect.sinkValue[" "](x);return x};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(obj,prop){try{goog.reflect.sinkValue(obj[prop]);return true}catch(e){}return false};goog.provide("goog.events.BrowserEvent");goog.provide("goog.events.BrowserEvent.MouseButton");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Event");goog.require("goog.events.EventType");goog.require("goog.reflect");goog.require("goog.userAgent");goog.events.BrowserEvent=function(opt_e,opt_currentTarget){if(opt_e)this.init(opt_e,opt_currentTarget)};goog.inherits(goog.events.BrowserEvent,goog.events.Event);goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};
goog.events.BrowserEvent.IEButtonMap=[1,4,2];goog.events.BrowserEvent.prototype.target=null;goog.events.BrowserEvent.prototype.currentTarget;goog.events.BrowserEvent.prototype.relatedTarget=null;goog.events.BrowserEvent.prototype.offsetX=0;goog.events.BrowserEvent.prototype.offsetY=0;goog.events.BrowserEvent.prototype.clientX=0;goog.events.BrowserEvent.prototype.clientY=0;goog.events.BrowserEvent.prototype.screenX=0;goog.events.BrowserEvent.prototype.screenY=0;
goog.events.BrowserEvent.prototype.button=0;goog.events.BrowserEvent.prototype.keyCode=0;goog.events.BrowserEvent.prototype.charCode=0;goog.events.BrowserEvent.prototype.ctrlKey=false;goog.events.BrowserEvent.prototype.altKey=false;goog.events.BrowserEvent.prototype.shiftKey=false;goog.events.BrowserEvent.prototype.metaKey=false;goog.events.BrowserEvent.prototype.state;goog.events.BrowserEvent.prototype.platformModifierKey=false;goog.events.BrowserEvent.prototype.event_=null;
goog.events.BrowserEvent.prototype.init=function(e,opt_currentTarget){var type=this.type=e.type;goog.events.Event.call(this,type);this.target=(e.target)||e.srcElement;this.currentTarget=(opt_currentTarget);var relatedTarget=(e.relatedTarget);if(relatedTarget){if(goog.userAgent.GECKO)if(!goog.reflect.canAccessProperty(relatedTarget,"nodeName"))relatedTarget=null}else if(type==goog.events.EventType.MOUSEOVER)relatedTarget=e.fromElement;else if(type==goog.events.EventType.MOUSEOUT)relatedTarget=e.toElement;
this.relatedTarget=relatedTarget;this.offsetX=goog.userAgent.WEBKIT||e.offsetX!==undefined?e.offsetX:e.layerX;this.offsetY=goog.userAgent.WEBKIT||e.offsetY!==undefined?e.offsetY:e.layerY;this.clientX=e.clientX!==undefined?e.clientX:e.pageX;this.clientY=e.clientY!==undefined?e.clientY:e.pageY;this.screenX=e.screenX||0;this.screenY=e.screenY||0;this.button=e.button;this.keyCode=e.keyCode||0;this.charCode=e.charCode||(type=="keypress"?e.keyCode:0);this.ctrlKey=e.ctrlKey;this.altKey=e.altKey;this.shiftKey=
e.shiftKey;this.metaKey=e.metaKey;this.platformModifierKey=goog.userAgent.MAC?e.metaKey:e.ctrlKey;this.state=e.state;this.event_=e;if(e.defaultPrevented)this.preventDefault();delete this.propagationStopped_};
goog.events.BrowserEvent.prototype.isButton=function(button){if(!goog.events.BrowserFeature.HAS_W3C_BUTTON)if(this.type=="click")return button==goog.events.BrowserEvent.MouseButton.LEFT;else return!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[button]);else return this.event_.button==button};goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)};
goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);if(this.event_.stopPropagation)this.event_.stopPropagation();else this.event_.cancelBubble=true};
goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var be=this.event_;if(!be.preventDefault){be.returnValue=false;if(goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{var VK_F1=112;var VK_F12=123;if(be.ctrlKey||be.keyCode>=VK_F1&&be.keyCode<=VK_F12)be.keyCode=-1}catch(ex){}}else be.preventDefault()};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};
goog.events.BrowserEvent.prototype.disposeInternal=function(){};goog.provide("goog.events.EventWrapper");goog.events.EventWrapper=function(){};goog.events.EventWrapper.prototype.listen=function(src,listener,opt_capt,opt_scope,opt_eventHandler){};goog.events.EventWrapper.prototype.unlisten=function(src,listener,opt_capt,opt_scope,opt_eventHandler){};goog.provide("goog.events.Listenable");goog.provide("goog.events.ListenableKey");goog.require("goog.events.EventLike");goog.events.Listenable=function(){};goog.events.Listenable.USE_LISTENABLE_INTERFACE=false;goog.events.Listenable.IMPLEMENTED_BY_PROP_="__closure_listenable";goog.events.Listenable.addImplementation=function(cls){cls.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP_]=true};goog.events.Listenable.isImplementedBy=function(obj){return!!(obj&&obj[goog.events.Listenable.IMPLEMENTED_BY_PROP_])};
goog.events.Listenable.prototype.listen;goog.events.Listenable.prototype.listenOnce;goog.events.Listenable.prototype.unlisten;goog.events.Listenable.prototype.unlistenByKey;goog.events.Listenable.prototype.dispatchEvent;goog.events.Listenable.prototype.removeAllListeners;goog.events.Listenable.prototype.fireListeners;goog.events.Listenable.prototype.getListeners;goog.events.Listenable.prototype.getListener;goog.events.Listenable.prototype.hasListener;goog.events.ListenableKey=function(){};
goog.events.ListenableKey.counter_=0;goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_};goog.events.ListenableKey.prototype.src;goog.events.ListenableKey.prototype.type;goog.events.ListenableKey.prototype.listener;goog.events.ListenableKey.prototype.capture;goog.events.ListenableKey.prototype.handler;goog.events.ListenableKey.prototype.key;goog.provide("goog.events.Listener");goog.require("goog.events.ListenableKey");goog.events.Listener=function(){if(goog.events.Listener.ENABLE_MONITORING)this.creationStack=(new Error).stack};goog.events.Listener.ENABLE_MONITORING=false;goog.events.Listener.prototype.isFunctionListener_;goog.events.Listener.prototype.listener;goog.events.Listener.prototype.proxy;goog.events.Listener.prototype.src;goog.events.Listener.prototype.type;goog.events.Listener.prototype.capture;goog.events.Listener.prototype.handler;
goog.events.Listener.prototype.key=0;goog.events.Listener.prototype.removed=false;goog.events.Listener.prototype.callOnce=false;goog.events.Listener.prototype.creationStack;
goog.events.Listener.prototype.init=function(listener,proxy,src,type,capture,opt_handler){if(goog.isFunction(listener))this.isFunctionListener_=true;else if(listener&&listener.handleEvent&&goog.isFunction(listener.handleEvent))this.isFunctionListener_=false;else throw Error("Invalid listener argument");this.listener=listener;this.proxy=proxy;this.src=src;this.type=type;this.capture=!!capture;this.handler=opt_handler;this.callOnce=false;this.key=goog.events.ListenableKey.reserveKey();this.removed=
false};goog.events.Listener.prototype.handleEvent=function(eventObject){if(this.isFunctionListener_)return this.listener.call(this.handler||this.src,eventObject);return this.listener.handleEvent.call(this.listener,eventObject)};goog.provide("goog.object");goog.object.forEach=function(obj,f,opt_obj){for(var key in obj)f.call(opt_obj,obj[key],key,obj)};goog.object.filter=function(obj,f,opt_obj){var res={};for(var key in obj)if(f.call(opt_obj,obj[key],key,obj))res[key]=obj[key];return res};goog.object.map=function(obj,f,opt_obj){var res={};for(var key in obj)res[key]=f.call(opt_obj,obj[key],key,obj);return res};goog.object.some=function(obj,f,opt_obj){for(var key in obj)if(f.call(opt_obj,obj[key],key,obj))return true;return false};
goog.object.every=function(obj,f,opt_obj){for(var key in obj)if(!f.call(opt_obj,obj[key],key,obj))return false;return true};goog.object.getCount=function(obj){var rv=0;for(var key in obj)rv++;return rv};goog.object.getAnyKey=function(obj){for(var key in obj)return key};goog.object.getAnyValue=function(obj){for(var key in obj)return obj[key]};goog.object.contains=function(obj,val){return goog.object.containsValue(obj,val)};
goog.object.getValues=function(obj){var res=[];var i=0;for(var key in obj)res[i++]=obj[key];return res};goog.object.getKeys=function(obj){var res=[];var i=0;for(var key in obj)res[i++]=key;return res};goog.object.getValueByKeys=function(obj,var_args){var isArrayLike=goog.isArrayLike(var_args);var keys=isArrayLike?var_args:arguments;for(var i=isArrayLike?0:1;i<keys.length;i++){obj=obj[keys[i]];if(!goog.isDef(obj))break}return obj};goog.object.containsKey=function(obj,key){return key in obj};
goog.object.containsValue=function(obj,val){for(var key in obj)if(obj[key]==val)return true;return false};goog.object.findKey=function(obj,f,opt_this){for(var key in obj)if(f.call(opt_this,obj[key],key,obj))return key;return undefined};goog.object.findValue=function(obj,f,opt_this){var key=goog.object.findKey(obj,f,opt_this);return key&&obj[key]};goog.object.isEmpty=function(obj){for(var key in obj)return false;return true};goog.object.clear=function(obj){for(var i in obj)delete obj[i]};
goog.object.remove=function(obj,key){var rv;if(rv=key in obj)delete obj[key];return rv};goog.object.add=function(obj,key,val){if(key in obj)throw Error('The object already contains the key "'+key+'"');goog.object.set(obj,key,val)};goog.object.get=function(obj,key,opt_val){if(key in obj)return obj[key];return opt_val};goog.object.set=function(obj,key,value){obj[key]=value};goog.object.setIfUndefined=function(obj,key,value){return key in obj?obj[key]:obj[key]=value};
goog.object.clone=function(obj){var res={};for(var key in obj)res[key]=obj[key];return res};goog.object.unsafeClone=function(obj){var type=goog.typeOf(obj);if(type=="object"||type=="array"){if(obj.clone)return obj.clone();var clone=type=="array"?[]:{};for(var key in obj)clone[key]=goog.object.unsafeClone(obj[key]);return clone}return obj};goog.object.transpose=function(obj){var transposed={};for(var key in obj)transposed[obj[key]]=key;return transposed};
goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.object.extend=function(target,var_args){var key,source;for(var i=1;i<arguments.length;i++){source=arguments[i];for(key in source)target[key]=source[key];for(var j=0;j<goog.object.PROTOTYPE_FIELDS_.length;j++){key=goog.object.PROTOTYPE_FIELDS_[j];if(Object.prototype.hasOwnProperty.call(source,key))target[key]=source[key]}}};
goog.object.create=function(var_args){var argLength=arguments.length;if(argLength==1&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(argLength%2)throw Error("Uneven number of arguments");var rv={};for(var i=0;i<argLength;i+=2)rv[arguments[i]]=arguments[i+1];return rv};
goog.object.createSet=function(var_args){var argLength=arguments.length;if(argLength==1&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);var rv={};for(var i=0;i<argLength;i++)rv[arguments[i]]=true;return rv};goog.object.createImmutableView=function(obj){var result=obj;if(Object.isFrozen&&!Object.isFrozen(obj)){result=Object.create(obj);Object.freeze(result)}return result};goog.object.isImmutableView=function(obj){return!!Object.isFrozen&&Object.isFrozen(obj)};goog.provide("goog.events");goog.provide("goog.events.Key");goog.require("goog.array");goog.require("goog.debug.entryPointRegistry");goog.require("goog.debug.errorHandlerWeakDep");goog.require("goog.events.BrowserEvent");goog.require("goog.events.BrowserFeature");goog.require("goog.events.Event");goog.require("goog.events.EventWrapper");goog.require("goog.events.Listenable");goog.require("goog.events.Listener");goog.require("goog.object");goog.require("goog.userAgent");goog.events.Key;goog.events.ListenableType;
goog.events.listeners_={};goog.events.listenerTree_={};goog.events.sources_={};goog.events.onString_="on";goog.events.onStringMap_={};goog.events.keySeparator_="_";
goog.events.listen=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.listen(src,type[i],listener,opt_capt,opt_handler);return null}var listenableKey;if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(src))listenableKey=src.listen((type),goog.events.wrapListener_(listener),opt_capt,opt_handler);else listenableKey=goog.events.listen_((src),type,listener,false,opt_capt,opt_handler);var key=listenableKey.key;
goog.events.listeners_[key]=listenableKey;return key};
goog.events.listen_=function(src,type,listener,callOnce,opt_capt,opt_handler){if(!type)throw Error("Invalid event type");var capture=!!opt_capt;var map=goog.events.listenerTree_;if(!(type in map))map[type]={count_:0,remaining_:0};map=map[type];if(!(capture in map)){map[capture]={count_:0,remaining_:0};map.count_++}map=map[capture];var srcUid=goog.getUid(src);var listenerArray,listenerObj;map.remaining_++;if(!map[srcUid]){listenerArray=map[srcUid]=[];map.count_++}else{listenerArray=map[srcUid];for(var i=
0;i<listenerArray.length;i++){listenerObj=listenerArray[i];if(listenerObj.listener==listener&&listenerObj.handler==opt_handler){if(listenerObj.removed)break;if(!callOnce)listenerArray[i].callOnce=false;return listenerArray[i]}}}var proxy=goog.events.getProxy();listenerObj=new goog.events.Listener;listenerObj.init(listener,proxy,src,type,capture,opt_handler);listenerObj.callOnce=callOnce;proxy.src=src;proxy.listener=listenerObj;listenerArray.push(listenerObj);if(!goog.events.sources_[srcUid])goog.events.sources_[srcUid]=
[];goog.events.sources_[srcUid].push(listenerObj);if(src.addEventListener){if(src==goog.global||!src.customEvent_)src.addEventListener(type,proxy,capture)}else src.attachEvent(goog.events.getOnString_(type),proxy);return listenerObj};
goog.events.getProxy=function(){var proxyCallbackFunction=goog.events.handleBrowserEvent_;var f=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(eventObject){return proxyCallbackFunction.call(f.src,f.listener,eventObject)}:function(eventObject){var v=proxyCallbackFunction.call(f.src,f.listener,eventObject);if(!v)return v};return f};
goog.events.listenOnce=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.listenOnce(src,type[i],listener,opt_capt,opt_handler);return null}var listenableKey;if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(src))listenableKey=src.listenOnce((type),goog.events.wrapListener_(listener),opt_capt,opt_handler);else listenableKey=goog.events.listen_((src),type,listener,true,opt_capt,opt_handler);var key=
listenableKey.key;goog.events.listeners_[key]=listenableKey;return key};goog.events.listenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.listen(src,listener,opt_capt,opt_handler)};
goog.events.unlisten=function(src,type,listener,opt_capt,opt_handler){if(goog.isArray(type)){for(var i=0;i<type.length;i++)goog.events.unlisten(src,type[i],listener,opt_capt,opt_handler);return null}if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(src))return src.unlisten((type),goog.events.wrapListener_(listener),opt_capt,opt_handler);var capture=!!opt_capt;var listenerArray=goog.events.getListeners_(src,type,capture);if(!listenerArray)return false;for(var i=
0;i<listenerArray.length;i++)if(listenerArray[i].listener==listener&&listenerArray[i].capture==capture&&listenerArray[i].handler==opt_handler)return goog.events.unlistenByKey(listenerArray[i].key);return false};
goog.events.unlistenByKey=function(key){var listener=goog.events.listeners_[key];if(!listener)return false;if(listener.removed)return false;var src=listener.src;if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(src))return src.unlistenByKey(listener);var type=listener.type;var proxy=listener.proxy;var capture=listener.capture;if(src.removeEventListener){if(src==goog.global||!src.customEvent_)src.removeEventListener(type,proxy,capture)}else if(src.detachEvent)src.detachEvent(goog.events.getOnString_(type),
proxy);var srcUid=goog.getUid(src);if(goog.events.sources_[srcUid]){var sourcesArray=goog.events.sources_[srcUid];goog.array.remove(sourcesArray,listener);if(sourcesArray.length==0)delete goog.events.sources_[srcUid]}listener.removed=true;var listenerArray=goog.events.listenerTree_[type][capture][srcUid];if(listenerArray){listenerArray.needsCleanup_=true;goog.events.cleanUp_(type,capture,srcUid,listenerArray)}delete goog.events.listeners_[key];return true};
goog.events.unlistenWithWrapper=function(src,wrapper,listener,opt_capt,opt_handler){wrapper.unlisten(src,listener,opt_capt,opt_handler)};goog.events.cleanUp=function(listenableKey){delete goog.events.listeners_[listenableKey.key]};
goog.events.cleanUp_=function(type,capture,srcUid,listenerArray){if(!listenerArray.locked_)if(listenerArray.needsCleanup_){for(var oldIndex=0,newIndex=0;oldIndex<listenerArray.length;oldIndex++){if(listenerArray[oldIndex].removed){var proxy=listenerArray[oldIndex].proxy;proxy.src=null;continue}if(oldIndex!=newIndex)listenerArray[newIndex]=listenerArray[oldIndex];newIndex++}listenerArray.length=newIndex;listenerArray.needsCleanup_=false;if(newIndex==0){delete goog.events.listenerTree_[type][capture][srcUid];
goog.events.listenerTree_[type][capture].count_--;if(goog.events.listenerTree_[type][capture].count_==0){delete goog.events.listenerTree_[type][capture];goog.events.listenerTree_[type].count_--}if(goog.events.listenerTree_[type].count_==0)delete goog.events.listenerTree_[type]}}};
goog.events.removeAll=function(opt_obj,opt_type){var count=0;var noObj=opt_obj==null;var noType=opt_type==null;if(!noObj){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&opt_obj&&goog.events.Listenable.isImplementedBy(opt_obj))return opt_obj.removeAllListeners(opt_type);var srcUid=goog.getUid((opt_obj));if(goog.events.sources_[srcUid]){var sourcesArray=goog.events.sources_[srcUid];for(var i=sourcesArray.length-1;i>=0;i--){var listener=sourcesArray[i];if(noType||opt_type==listener.type){goog.events.unlistenByKey(listener.key);
count++}}}}else goog.object.forEach(goog.events.listeners_,function(listener,key){goog.events.unlistenByKey(key);count++});return count};goog.events.getListeners=function(obj,type,capture){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(obj))return obj.getListeners(type,capture);else return goog.events.getListeners_(obj,type,capture)||[]};
goog.events.getListeners_=function(obj,type,capture){var map=goog.events.listenerTree_;if(type in map){map=map[type];if(capture in map){map=map[capture];var objUid=goog.getUid(obj);if(map[objUid])return map[objUid]}}return null};
goog.events.getListener=function(src,type,listener,opt_capt,opt_handler){var capture=!!opt_capt;if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(src))return src.getListener((type),goog.events.wrapListener_(listener),capture,opt_handler);var listenerArray=goog.events.getListeners_(src,type,capture);if(listenerArray)for(var i=0;i<listenerArray.length;i++)if(!listenerArray[i].removed&&listenerArray[i].listener==listener&&listenerArray[i].capture==capture&&listenerArray[i].handler==
opt_handler)return listenerArray[i];return null};
goog.events.hasListener=function(obj,opt_type,opt_capture){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(obj))return obj.hasListener(opt_type,opt_capture);var objUid=goog.getUid(obj);var listeners=goog.events.sources_[objUid];if(listeners){var hasType=goog.isDef(opt_type);var hasCapture=goog.isDef(opt_capture);if(hasType&&hasCapture){var map=goog.events.listenerTree_[opt_type];return!!map&&!!map[opt_capture]&&objUid in map[opt_capture]}else if(!(hasType||
hasCapture))return true;else return goog.array.some(listeners,function(listener){return hasType&&listener.type==opt_type||hasCapture&&listener.capture==opt_capture})}return false};goog.events.expose=function(e){var str=[];for(var key in e)if(e[key]&&e[key].id)str.push(key+" = "+e[key]+" ("+e[key].id+")");else str.push(key+" = "+e[key]);return str.join("\n")};
goog.events.getOnString_=function(type){if(type in goog.events.onStringMap_)return goog.events.onStringMap_[type];return goog.events.onStringMap_[type]=goog.events.onString_+type};
goog.events.fireListeners=function(obj,type,capture,eventObject){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE&&goog.events.Listenable.isImplementedBy(obj))return obj.fireListeners(type,capture,eventObject);var map=goog.events.listenerTree_;if(type in map){map=map[type];if(capture in map)return goog.events.fireListeners_(map[capture],obj,type,capture,eventObject)}return true};
goog.events.fireListeners_=function(map,obj,type,capture,eventObject){var retval=1;var objUid=goog.getUid(obj);if(map[objUid]){var remaining=--map.remaining_;var listenerArray=map[objUid];if(!listenerArray.locked_)listenerArray.locked_=1;else listenerArray.locked_++;try{var length=listenerArray.length;for(var i=0;i<length;i++){var listener=listenerArray[i];if(listener&&!listener.removed)retval&=goog.events.fireListener(listener,eventObject)!==false}}finally{map.remaining_=Math.max(remaining,map.remaining_);
listenerArray.locked_--;goog.events.cleanUp_(type,capture,objUid,listenerArray)}}return Boolean(retval)};goog.events.fireListener=function(listener,eventObject){if(listener.callOnce)goog.events.unlistenByKey(listener.key);return listener.handleEvent(eventObject)};goog.events.getTotalListenerCount=function(){return goog.object.getCount(goog.events.listeners_)};
goog.events.dispatchEvent=function(src,e){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE)return src.dispatchEvent(e);var type=e.type||e;var map=goog.events.listenerTree_;if(!(type in map))return true;if(goog.isString(e))e=new goog.events.Event(e,src);else if(!(e instanceof goog.events.Event)){var oldEvent=e;e=new goog.events.Event((type),src);goog.object.extend(e,oldEvent)}else e.target=e.target||src;var rv=1,ancestors;map=map[type];var hasCapture=true in map;var targetsMap;if(hasCapture){ancestors=
[];for(var parent=src;parent;parent=parent.getParentEventTarget())ancestors.push(parent);targetsMap=map[true];targetsMap.remaining_=targetsMap.count_;for(var i=ancestors.length-1;!e.propagationStopped_&&i>=0&&targetsMap.remaining_;i--){e.currentTarget=ancestors[i];rv&=goog.events.fireListeners_(targetsMap,ancestors[i],e.type,true,e)&&e.returnValue_!=false}}var hasBubble=false in map;if(hasBubble){targetsMap=map[false];targetsMap.remaining_=targetsMap.count_;if(hasCapture)for(var i=0;!e.propagationStopped_&&
i<ancestors.length&&targetsMap.remaining_;i++){e.currentTarget=ancestors[i];rv&=goog.events.fireListeners_(targetsMap,ancestors[i],e.type,false,e)&&e.returnValue_!=false}else for(var current=src;!e.propagationStopped_&&current&&targetsMap.remaining_;current=current.getParentEventTarget()){e.currentTarget=current;rv&=goog.events.fireListeners_(targetsMap,current,e.type,false,e)&&e.returnValue_!=false}}return Boolean(rv)};
goog.events.protectBrowserEventEntryPoint=function(errorHandler){goog.events.handleBrowserEvent_=errorHandler.protectEntryPoint(goog.events.handleBrowserEvent_)};
goog.events.handleBrowserEvent_=function(listener,opt_evt){if(listener.removed)return true;var type=listener.type;var map=goog.events.listenerTree_;if(!(type in map))return true;map=map[type];var retval,targetsMap;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var ieEvent=opt_evt||(goog.getObjectByName("window.event"));var hasCapture=true in map;var hasBubble=false in map;if(hasCapture){if(goog.events.isMarkedIeEvent_(ieEvent))return true;goog.events.markIeEvent_(ieEvent)}var evt=new goog.events.BrowserEvent;
evt.init(ieEvent,(this));retval=true;try{if(hasCapture){var ancestors=[];for(var parent=evt.currentTarget;parent;parent=parent.parentNode)ancestors.push(parent);targetsMap=map[true];targetsMap.remaining_=targetsMap.count_;for(var i=ancestors.length-1;!evt.propagationStopped_&&i>=0&&targetsMap.remaining_;i--){evt.currentTarget=ancestors[i];retval&=goog.events.fireListeners_(targetsMap,ancestors[i],type,true,evt)}if(hasBubble){targetsMap=map[false];targetsMap.remaining_=targetsMap.count_;for(var i=
0;!evt.propagationStopped_&&i<ancestors.length&&targetsMap.remaining_;i++){evt.currentTarget=ancestors[i];retval&=goog.events.fireListeners_(targetsMap,ancestors[i],type,false,evt)}}}else retval=goog.events.fireListener(listener,evt)}finally{if(ancestors)ancestors.length=0}return retval}var be=new goog.events.BrowserEvent(opt_evt,(this));retval=goog.events.fireListener(listener,be);return retval};
goog.events.markIeEvent_=function(e){var useReturnValue=false;if(e.keyCode==0)try{e.keyCode=-1;return}catch(ex){useReturnValue=true}if(useReturnValue||(e.returnValue)==undefined)e.returnValue=true};goog.events.isMarkedIeEvent_=function(e){return e.keyCode<0||e.returnValue!=undefined};goog.events.uniqueIdCounter_=0;goog.events.getUniqueId=function(identifier){return identifier+"_"+goog.events.uniqueIdCounter_++};goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(Math.random()*1E9>>>0);
goog.events.wrapListener_=function(listener){if(goog.isFunction(listener))return listener;return listener[goog.events.LISTENER_WRAPPER_PROP_]||(listener[goog.events.LISTENER_WRAPPER_PROP_]=function(e){return listener.handleEvent(e)})};goog.debug.entryPointRegistry.register(function(transformer){goog.events.handleBrowserEvent_=transformer(goog.events.handleBrowserEvent_)});goog.provide("goog.events.EventTarget");goog.require("goog.Disposable");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.Listenable");goog.require("goog.events.Listener");goog.require("goog.object");goog.events.EventTarget=function(){goog.Disposable.call(this);if(goog.events.Listenable.USE_LISTENABLE_INTERFACE){this.eventTargetListeners_={};this.reallyDisposed_=false;this.actualEventTarget_=this}};goog.inherits(goog.events.EventTarget,goog.Disposable);if(goog.events.Listenable.USE_LISTENABLE_INTERFACE)goog.events.Listenable.addImplementation(goog.events.EventTarget);
goog.events.EventTarget.prototype.customEvent_=true;goog.events.EventTarget.prototype.parentEventTarget_=null;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};goog.events.EventTarget.prototype.setParentEventTarget=function(parent){this.parentEventTarget_=parent};goog.events.EventTarget.prototype.addEventListener=function(type,handler,opt_capture,opt_handlerScope){goog.events.listen(this,type,handler,opt_capture,opt_handlerScope)};
goog.events.EventTarget.prototype.removeEventListener=function(type,handler,opt_capture,opt_handlerScope){goog.events.unlisten(this,type,handler,opt_capture,opt_handlerScope)};
goog.events.EventTarget.prototype.dispatchEvent=function(e){if(goog.events.Listenable.USE_LISTENABLE_INTERFACE){if(this.reallyDisposed_)return true;var ancestorsTree,ancestor=this.getParentEventTarget();if(ancestor){ancestorsTree=[];for(;ancestor;ancestor=ancestor.getParentEventTarget())ancestorsTree.push(ancestor)}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,e,ancestorsTree)}else return goog.events.dispatchEvent(this,e)};
goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);if(goog.events.Listenable.USE_LISTENABLE_INTERFACE){this.removeAllListeners();this.reallyDisposed_=true}else goog.events.removeAll(this);this.parentEventTarget_=null};
if(goog.events.Listenable.USE_LISTENABLE_INTERFACE){goog.events.EventTarget.prototype.listen=function(type,listener,opt_useCapture,opt_listenerScope){return this.listenInternal_(type,listener,false,opt_useCapture,opt_listenerScope)};goog.events.EventTarget.prototype.listenOnce=function(type,listener,opt_useCapture,opt_listenerScope){return this.listenInternal_(type,listener,true,opt_useCapture,opt_listenerScope)};goog.events.EventTarget.prototype.listenInternal_=function(type,listener,callOnce,opt_useCapture,
opt_listenerScope){goog.asserts.assert(!this.reallyDisposed_,"Can not listen on disposed object.");var listenerArray=this.eventTargetListeners_[type]||(this.eventTargetListeners_[type]=[]);var listenerObj;var index=goog.events.EventTarget.findListenerIndex_(listenerArray,listener,opt_useCapture,opt_listenerScope);if(index>-1){listenerObj=listenerArray[index];if(!callOnce)listenerObj.callOnce=false;return listenerObj}listenerObj=new goog.events.Listener;listenerObj.init(listener,null,this,type,!!opt_useCapture,
opt_listenerScope);listenerObj.callOnce=callOnce;listenerArray.push(listenerObj);return listenerObj};goog.events.EventTarget.prototype.unlisten=function(type,listener,opt_useCapture,opt_listenerScope){if(!(type in this.eventTargetListeners_))return false;var listenerArray=this.eventTargetListeners_[type];var index=goog.events.EventTarget.findListenerIndex_(listenerArray,listener,opt_useCapture,opt_listenerScope);if(index>-1){var listenerObj=listenerArray[index];goog.events.cleanUp(listenerObj);listenerObj.removed=
true;return goog.array.removeAt(listenerArray,index)}return false};goog.events.EventTarget.prototype.unlistenByKey=function(key){var type=key.type;if(!(type in this.eventTargetListeners_))return false;var removed=goog.array.remove(this.eventTargetListeners_[type],key);if(removed){goog.events.cleanUp(key);key.removed=true}return removed};goog.events.EventTarget.prototype.removeAllListeners=function(opt_type,opt_capture){var count=0;for(var type in this.eventTargetListeners_)if(!opt_type||type==opt_type){var listenerArray=
this.eventTargetListeners_[type];for(var i=0;i<listenerArray.length;i++){++count;goog.events.cleanUp(listenerArray[i]);listenerArray[i].removed=true}listenerArray.length=0}return count};goog.events.EventTarget.prototype.fireListeners=function(type,capture,eventObject){goog.asserts.assert(!this.reallyDisposed_,"Can not fire listeners after dispose() completed.");if(!(type in this.eventTargetListeners_))return true;var rv=true;var listenerArray=goog.array.clone(this.eventTargetListeners_[type]);for(var i=
0;i<listenerArray.length;++i){var listener=listenerArray[i];if(listener&&!listener.removed&&listener.capture==capture){if(listener.callOnce)this.unlistenByKey(listener);rv=listener.handleEvent(eventObject)!==false&&rv}}return rv&&eventObject.returnValue_!=false};goog.events.EventTarget.prototype.getListeners=function(type,capture){var listenerArray=this.eventTargetListeners_[type];var rv=[];if(listenerArray)for(var i=0;i<listenerArray.length;++i){var listenerObj=listenerArray[i];if(listenerObj.capture==
capture)rv.push(listenerObj)}return rv};goog.events.EventTarget.prototype.getListener=function(type,listener,capture,opt_listenerScope){var listenerArray=this.eventTargetListeners_[type];var i=-1;if(listenerArray)i=goog.events.EventTarget.findListenerIndex_(listenerArray,listener,capture,opt_listenerScope);return i>-1?listenerArray[i]:null};goog.events.EventTarget.prototype.hasListener=function(opt_type,opt_capture){var hasType=goog.isDef(opt_type);var hasCapture=goog.isDef(opt_capture);return goog.object.some(this.eventTargetListeners_,
function(listenersArray,type){for(var i=0;i<listenersArray.length;++i)if((!hasType||listenersArray[i].type==opt_type)&&(!hasCapture||listenersArray[i].capture==opt_capture))return true;return false})};goog.events.EventTarget.prototype.setTargetForTesting=function(target){this.actualEventTarget_=target};goog.events.EventTarget.dispatchEventInternal_=function(target,e,opt_ancestorsTree){var type=e.type||(e);if(goog.isString(e))e=new goog.events.Event(e,target);else if(!(e instanceof goog.events.Event)){var oldEvent=
e;e=new goog.events.Event(type,target);goog.object.extend(e,oldEvent)}else e.target=e.target||target;var rv=true,currentTarget;if(opt_ancestorsTree)for(var i=opt_ancestorsTree.length-1;!e.propagationStopped_&&i>=0;i--){currentTarget=e.currentTarget=opt_ancestorsTree[i];rv=currentTarget.fireListeners(type,true,e)&&rv}if(!e.propagationStopped_){currentTarget=e.currentTarget=target;rv=currentTarget.fireListeners(type,true,e)&&rv;if(!e.propagationStopped_)rv=currentTarget.fireListeners(type,false,e)&&
rv}if(opt_ancestorsTree)for(i=0;!e.propagationStopped_&&i<opt_ancestorsTree.length;i++){currentTarget=e.currentTarget=opt_ancestorsTree[i];rv=currentTarget.fireListeners(type,false,e)&&rv}return rv};goog.events.EventTarget.findListenerIndex_=function(listenerArray,listener,opt_useCapture,opt_listenerScope){for(var i=0;i<listenerArray.length;++i){var listenerObj=listenerArray[i];if(listenerObj.listener==listener&&listenerObj.capture==!!opt_useCapture&&listenerObj.handler==opt_listenerScope)return i}return-1}};goog.provide("crow.Graph");goog.require("crow.util.Assert");goog.require("crow.Algorithm");goog.require("goog.events.EventTarget");
crow.Graph=function(){this.nodes=[];this.map={};this.version="0";this.validator=new goog.events.EventTarget;this.width=0;this.height=0;this.addNode=function(node){node._initialize();if(node.getX&&node.getY){var x=node.getX(),y=node.getY();if(x+1>this.width)this.width=x+1;if(y+1>this.height)this.height=y+1}this.nodes.push(node);this.map[node.id]=node};this.removeNode=function(x,y,alsoInvalidate){if(typeof x==="number"){delete this.map[""+x+"_"+y];for(var i=0;i<this.nodes.length;i++){var node=this.nodes[i];
if(node.x==x&&node.y==y){this.nodes.splice(i,1);break}}if(alsoInvalidate)this.invalidate(x,y)}else delete this.map[x.id]};this.getNode=function(x_or_filter,y,orBlankNode){var node;if(typeof x_or_filter==="function")for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];if(x_or_filter.call(n)){node=n;break}}else if(typeof x_or_filter==="string")return this.map[x_or_filter];else{if(typeof x_or_filter!=="number")throw new Error("x coordinate not provided");if(typeof y!=="number")throw new Error("y coordinate not provided");
node=this.map[""+x_or_filter+"_"+y]}if(node)return node;else if(orBlankNode&&typeof x_or_filter==="number"){var node=new crow.BaseNode([x_or_filter,y]);node.isBlank=true;return node}else return undefined};this.getNodes=function(filter_or_options){switch(typeof filter_or_options){case "function":return this.getNodes({filter:filter_or_options});case "object":var start=filter_or_options.start||this.nodes[0];var algo=crow.Graph._lookupAlgorithm(filter_or_options.algorithm||"linear");if(!(algo.prototype instanceof
crow.algorithm.SearchAlgorithm))throw new Error("only compatible with SearchAlgorithms");return(new algo(this)).search(start,{filter:filter_or_options.filter});case "undefined":return this.nodes;default:throw new Error("unsupported object "+filter_or_options.toString());}};this.findGoal=function(opts){return crow.Graph.findGoal(opts,this)};this.invalidate=function(x,y,dx,dy){if(dx==0||dy==0)throw new Error("dx and dy can't be 0");if(dx&&dy)this.validator.dispatchEvent({type:"invalidateRegion",x:x,
y:y,dx:dx,dy:dy});else this.validator.dispatchEvent({type:"invalidatePoint",x:x,y:y})}};
crow.Graph.findGoal=function(opts,graph){crow.Algorithm.initializeDataStructures();var start=opts.start||graph&&graph.nodes[0];if(!start)throw new Error("To go somewhere you must know where you start...perhaps you meant to provide a start node?");var goal=opts.goal;var algo=crow.Graph._lookupAlgorithm(opts.algorithm)||crow.AlgorithmResolver.getAlgorithm();if(!(algo.prototype instanceof crow.algorithm.ShortestPathAlgorithm))throw new Error("only compatible with ShortestPathAlgorithms");opts.graph=
graph;return(new algo(graph)).findPath(start,goal,opts)};crow.Graph.algorithm={};crow.Graph.defaultAlgorithm={};
crow.Graph.fromTilePlane=function(tplane,callback){if(!window.Effect||!window.Effect.Port)throw new Error("EffectGames-specific extensions don't work anywhere else");if(!tplane)throw new Error("tplane is required");if(typeof callback!=="function")throw new Error("callback not provided or not a function");var g=new crow.Graph;for(var i=0,ilen=tplane.getMaxTileX();i<ilen;i++)for(var j=0,jlen=tplane.getMaxTileY();j<jlen;j++){var tile=tplane.lookupTile(i,j),tileData=tplane.lookupTile(i,j,true);var node=
callback(tile,tileData);if(node)g.addNode(node)}return g};crow.Graph.fromArray=function(array,callback){crow.assert(array instanceof Array,crow.assert.InvalidArgumentType("Array"));var graph=new crow.Graph;var x,y=0;for(var i=0;i<array.length;i++){x=0;var row=array[i];for(var ch_idx=0;ch_idx<row.length;ch_idx++){var ch=row.charAt(ch_idx);var node=callback(x,y,ch);if(node)graph.addNode(node);x++}y++}return graph};
crow.Graph.registerAlgorithm=function(algo){var alias=algo["alias"];if(!alias)throw new Error("No alias found for algorithm");crow.Graph.algorithm[alias]=algo};crow.Graph._lookupAlgorithm=function(alias_or_opts){var type=typeof alias_or_opts;if(type==="string"){var algo=crow.Graph.algorithm[alias_or_opts];if(algo)return algo;throw new Error("Algorithm `"+alias_or_opts+"` not found");}else if(type==="object"||type==="undefined"){var algo=crow.AlgorithmResolver.getAlgorithm(alias_or_opts);if(algo)return algo}return null};
crow.GraphUtil={distance:{euclidean:function(dx,dy){return Math.sqrt(Math.pow(dx,2)+Math.pow(dy,2))},manhattan:function(dx,dy){return Math.abs(dx)+Math.abs(dy)},chebyshev:function(dx,dy){return Math.max(Math.abs(dx),Math.abs(dy))},one:function(){return 1}}};crow.GraphUtil.distance.pythagoras=crow.GraphUtil.distance.euclidean;crow.GraphUtil.distance.maximum=crow.GraphUtil.distance.chebyshev;crow.GraphUtil.distance.manhattan8=crow.GraphUtil.distance.chebyshev;goog.provide("crow.AlgorithmResolver");
crow.AlgorithmResolver=new function(){this.getAlgorithm=function(opts){return this.getAlgorithms(opts).dequeue()};this.getAlgorithms=function(opts){if(!opts)opts={};if(typeof opts.heuristics_allowed==="undefined")opts.heuristics_allowed=true;var algos=crow.Graph.algorithm;var queue=new crow.structs.BucketPriorityQueue(crow.structs.BucketPriorityQueue.REVERSE_KEY_COMPARATOR);for(var i in algos){var algo=algos[i];var attributes=algo.attributes;if(attributes){var score=0;if(typeof opts.min_speed!=="undefined"&&
opts.min_speed>attributes.min_speed)score-=Infinity;else score+=attributes.min_speed;if(opts.moving_start&&!attributes.moving_start||opts.moving_goal&&!attributes.moving_goal||opts.unstable_graph&&!attributes.unstable_graph||!opts.heuristics_allowed&&attributes.heuristics_allowed||opts.goal_is_node&&!attributes.goal_is_node||opts.goal_is_callback&&!attributes.goal_is_callback)score-=Infinity;if(score>-Infinity)queue.enqueue(score,algo)}}return queue}};goog.provide("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.Algorithm");crow.algorithm.ShortestPathAlgorithm=function(){};crow.algorithm.ShortestPathAlgorithm.prototype=new crow.Algorithm;crow.algorithm.ShortestPathAlgorithm.prototype.findPath=function(start,end,opts){this.wrapperNode=new crow.Algorithm.NodeMap};goog.provide("crow.Node");crow.Node=function(id){if(!id)id=""+Math.random();this.id=id};crow.Node.prototype.distanceAlgorithm=crow.GraphUtil.distance.manhattan;crow.Node.prototype.distanceToGoal=function(){throw new Error("This method (either distanceToGoal or distanceToNeighbor) was called, but is not implemented.  You must override this method in your own class to determine the distance between nodes.");};
crow.Node.prototype.distanceToNeighbor=function(){throw new Error("distanceToNeighbor must be overridden");};crow.Node.prototype.getNeighbors=function(graph){throw new Error("This method (getNeighbors) was called, but is not implemented.  You need to implement it so that the algorithm knows how to find the nodes reachable from the current node.");};goog.provide("crow.GridNode");goog.require("crow.Node");crow.GridNode=function(arr){crow.Node.apply(this);if(arr){this.x=arr[0];this.y=arr[1]}this.isBlank=false;this._initialized=false};crow.GridNode.prototype=new crow.Node;
crow.GridNode.prototype._initialize=function(){if(!this._initialized){this._initialized=true;var x=this.getX(),y=this.getY();if(typeof x!=="number")throw new Error("Node must have a valid x coord");if(typeof y!=="number")throw new Error("Node must have a valid y coord");x=Math.floor(x);y=Math.floor(y);this.x=x;this.y=y;this.generateId();delete this.getX;delete this.getY;if(this.distanceToNeighbor==crow.Node.prototype.distanceToNeighbor)this.distanceToNeighbor=this.distanceToGoal}};
crow.GridNode.prototype.getX=function(){return this.x};crow.GridNode.prototype.getY=function(){return this.y};crow.GridNode.prototype.distanceToGoal=function(other,actor){var dx=this.x-other.x,dy=this.y-other.y;return this.distanceAlgorithm(dx,dy)};crow.GridNode.prototype.generateId=function(){this.id=this.x+"_"+this.y;return this.id};
crow.GridNode.prototype.getNeighbors=function(graph,includeDiagonals,includeNulls){var ox=this.x,oy=this.y;var rawNeighbors=[];rawNeighbors.push(graph.getNode(ox+1,oy));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox+1,oy+1));rawNeighbors.push(graph.getNode(ox,oy+1));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox-1,oy+1));rawNeighbors.push(graph.getNode(ox-1,oy));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox-1,oy-1));rawNeighbors.push(graph.getNode(ox,oy-1));if(includeDiagonals)rawNeighbors.push(graph.getNode(ox+
1,oy-1));var neighbors=[];for(var i=0;i<rawNeighbors.length;i++){var neighbor=rawNeighbors[i];if(neighbor)neighbors.push(neighbor);else if(includeNulls)neighbors.push(null)}return neighbors};goog.provide("crow.BaseNode");goog.require("crow.GridNode");crow.BaseNode=crow.GridNode;goog.provide("crow.algorithm.Path");goog.require("crow.BaseNode");goog.require("crow.util.Assert");
crow.algorithm.Path=function(opts){this.nodes=opts.nodes;this.start=opts.start;this.goal=opts.goal;this.end=opts.goal;this.length=opts.length;this.found=opts.found;this.algorithm=null;this.graph=null;this.actor=null;this._baked=true;if(opts.baked===false){this._baked=false;this.algorithm=opts.algorithm;this.graph=opts.graph;this.actor=opts.actor;if(this.graph){this.graph.validator.addEventListener("invalidatePoint",this._invalidatePoint,null,this);this.graph.validator.addEventListener("invalidateRegion",
this._invalidateRegion,null,this)}}};crow.algorithm.Path.prototype.copyTo=function(other){for(var i in this)other[i]=this[i]};crow.algorithm.Path.prototype._invalidatePoint=function(e){if(this._baked)return;this.algorithm._invalidatePoint(this,e)};crow.algorithm.Path.prototype._invalidateRegion=function(e){if(this._baked)return;this.algorithm._invalidateRegion(this,e)};
crow.algorithm.Path.prototype.advanceTo=function(index_or_node){crow.assert(typeof index_or_node==="number"||index_or_node instanceof crow.BaseNode,crow.assert.InvalidArgumentType("number or crow.BaseNode"));if(typeof index_or_node==="number"){crow.assert(index_or_node>=0&&index_or_node<this.nodes.length,crow.assert.IndexOutBounds(index_or_node));return this.advanceTo(this.nodes[index_or_node])}else{var x=index_or_node.x,y=index_or_node.y,i;var found=false;for(i=0;i<this.nodes.length;i++){var n=this.nodes[i];
if(n.x===x&&n.y===y){found=true;break}}if(found){this.start=index_or_node;this.found=false;if(this.algorithm.moveStart)this.algorithm.moveStart(this,index_or_node)}else{this.nodes=[index_or_node];this.found=false;this.end=null}}};
crow.algorithm.Path.prototype.moveTarget=function(newGoal){if(!this.algorithm.klass.attributes.moving_goal)throw new Error(crow.assert.IllegalMethodCall("moveGoal","This method is intended only to be used with algorithms that support moving targets."));this.goal=newGoal;this.found=false;if(this.algorithm.moveTarget)this.algorithm.moveTarget(this,newGoal)};crow.algorithm.Path.prototype.getNextNode=function(){return this.nodes[1]};
crow.algorithm.Path.prototype.continueCalculating=function(count){if(this._baked)throw new Error("Can't continue calculating a baked path.  Either pass {baked: false} to findGoal, or don't call .bake() on this path yet.");if(this.found)return true;return this.algorithm.continueCalculating(this,count)};
crow.algorithm.Path.prototype.bake=function(){this._baked=true;if(this.graph){this.graph.validator.removeEventListener("invalidatePoint",this._invalidatePoint);this.graph.validator.removeEventListener("invalidateRegion",this._invalidateRegion);this.graph=null}this.algorithm=null;this.actor=null};goog.provide("crow.algorithm.AStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.Graph");
(function(){crow.algorithm.AStarAlgorithm=function(graph){this.klass=crow.algorithm.AStarAlgorithm;this.graph=graph};crow.algorithm.AStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;crow.algorithm.AStarAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);if(typeof goal==="function")throw new Error("A* doesn't support using a callback to determine the goal");this._wrapperNode=new crow.Algorithm.NodeMap;
if(!opts)opts={};var actor=opts.actor;this.start=start;this.goal=goal;this.opts=opts;start=this._getWrapperNode(start);this.openSet=new crow.structs.BucketPriorityQueue;this.openSet.enqueue(0,start);start.g=0;start.h=start.innerNode.distanceToGoal(goal,actor);var found=false,currentNode;while(currentNode=this.openSet.dequeue()){if(currentNode.innerNode===goal){found=true;break}else if(currentNode.expanded)continue;currentNode.expanded=true;var neighbors=currentNode.innerNode.getNeighbors(this.graph);
for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(neighbor.expanded)continue;var newG=currentNode.g+currentNode.innerNode.distanceToNeighbor(neighbor.innerNode,actor);if(newG==Infinity)continue;if(!this.openSet.contains(neighbor)||newG<neighbor.g){neighbor.parent=currentNode;neighbor.g=newG;var h=neighbor.innerNode.distanceToGoal(goal,actor);neighbor.f=newG+h;this.openSet.enqueue(neighbor.f,neighbor)}}}var nodes=[];var pathOpts={nodes:nodes,start:start.innerNode,
goal:goal,length:null,recalculate:this.recalculate,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,actor:actor};if(found){var endNode=this._getWrapperNode(goal);nodes.unshift(endNode.innerNode);var node=endNode.parent;while(node){nodes.unshift(node.innerNode);node=node.parent}pathOpts.end=endNode.innerNode;pathOpts.length=endNode.g;pathOpts.found=true;return new crow.algorithm.Path(pathOpts)}else{pathOpts.end=null;pathOpts.length=Infinity;pathOpts.found=
false;return new crow.algorithm.Path(pathOpts)}};crow.algorithm.AStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.expanded=false;this.parent=null;this.g=Infinity;this.h=null;this.f=null};crow.algorithm.AStarAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.AStarAlgorithm.WrapperNode);crow.algorithm.AStarAlgorithm.attributes={min_speed:2,moving_start:false,moving_goal:false,unstable_graph:false,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};
crow.algorithm.AStarAlgorithm["alias"]="a*";crow.Graph.registerAlgorithm(crow.algorithm.AStarAlgorithm)})();goog.provide("crow.algorithm.BasicTraversalAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.ShortestPathAlgorithm");
(function(){crow.algorithm.BasicTraversalAlgorithm=function(graph){this.klass=crow.algorithm.BasicTraversalAlgorithm;this.graph=graph};crow.algorithm.BasicTraversalAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;crow.algorithm.BasicTraversalAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);if(typeof opts=="undefined")opts={};start=this._getWrapperNode(start);start.distance=0;this.actor=opts.actor;var filter=
opts.filter;var found=false;var queue=[start],list=[],el;while(el=this.getNext(queue)){el.pending=false;el.expanded=true;list.push(el.innerNode);if(el.innerNode==goal){found=true;break}var neighbors=el.innerNode.getNeighbors(this.graph);if(opts.random)neighbors=neighbors.shuffle();for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);if(neighbor.expanded||neighbor.pending)continue;if(el.innerNode.distanceToNeighbor(neighbor.innerNode,this.actor)<Infinity&&(!filter||filter.call(this,
neighbor))){this.addNext(queue,neighbor);neighbor.pending=true;neighbor.parent=el;neighbor.distance=el.distance+1}}}this.start=start;this.goal=goal;this.list=list;return this.resolveResults(found)};crow.algorithm.BasicTraversalAlgorithm.prototype.getNext=function(col){throw new Error("must implement");};crow.algorithm.BasicTraversalAlgorithm.prototype.addNext=function(col,val){col.push(val)};crow.algorithm.BasicTraversalAlgorithm.prototype.resolveResults=function(found){var nodes=[];var pathOpts=
{nodes:nodes,start:this.start.innerNode,goal:this.goal,algorithm:this,graph:this.graph,baked:true,actor:this.actor,found:found};if(found){var endNode=this._getWrapperNode(this.goal);nodes.unshift(endNode.innerNode);var node=endNode.parent;while(node){nodes.unshift(node.innerNode);node=node.parent}pathOpts.end=endNode.innerNode;pathOpts.length=endNode.distance}else{pathOpts.end=null;pathOpts.length=Infinity}var path=new crow.algorithm.Path(pathOpts);path.allNodes=this.list;return path};crow.algorithm.BasicTraversalAlgorithm.WrapperNode=
function(node){this.innerNode=node;this.expanded=false;this.pending=false;this.parent=null;this.distance=Infinity};crow.algorithm.BasicTraversalAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.BasicTraversalAlgorithm.WrapperNode)})();goog.provide("crow.algorithm.BFSAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.BasicTraversalAlgorithm");crow.algorithm.BFSAlgorithm=function(graph){this.klass=crow.algorithm.BFSAlgorithm;this.graph=graph};crow.algorithm.BFSAlgorithm.prototype=new crow.algorithm.BasicTraversalAlgorithm;crow.algorithm.BFSAlgorithm.prototype.getNext=function(col){return col.shift()};crow.algorithm.BFSAlgorithm["alias"]="bfs";crow.Graph.registerAlgorithm(crow.algorithm.BFSAlgorithm);goog.provide("crow.algorithm.SearchAlgorithm");goog.require("crow.Algorithm");crow.algorithm.SearchAlgorithm=function(){};crow.algorithm.SearchAlgorithm.prototype=new crow.Algorithm;crow.algorithm.SearchAlgorithm.prototype.search=function(start,opts){this.wrapperNode=new crow.Algorithm.NodeMap};goog.provide("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.algorithm.BFSAlgorithm");crow.algorithm.BFSBasicAlgorithm=function(graph){this.klass=crow.algorithm.BFSBasicAlgorithm;this.graph=graph};crow.algorithm.BFSBasicAlgorithm.prototype=new crow.algorithm.SearchAlgorithm;
crow.algorithm.BFSBasicAlgorithm.prototype.search=function(start,opts){var bfs=new crow.algorithm.BFSAlgorithm(this.graph);var path=bfs.findPath(start,null,opts);return path.allNodes};crow.algorithm.BFSBasicAlgorithm["alias"]="bfs_basic";crow.Graph.registerAlgorithm(crow.algorithm.BFSBasicAlgorithm);goog.provide("crow.algorithm.DFSAlgorithm");goog.require("crow.Graph");goog.require("crow.algorithm.BasicTraversalAlgorithm");crow.algorithm.DFSAlgorithm=function(graph){this.klass=crow.algorithm.DFSAlgorithm;this.graph=graph};crow.algorithm.DFSAlgorithm.prototype=new crow.algorithm.BasicTraversalAlgorithm;crow.algorithm.DFSAlgorithm.prototype.getNext=function(col){return col.pop()};crow.algorithm.DFSAlgorithm["alias"]="dfs";crow.Graph.registerAlgorithm(crow.algorithm.DFSAlgorithm);goog.provide("crow.algorithm.DijkstraAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.Graph");crow.algorithm.DijkstraAlgorithm=function(graph){this.klass=crow.algorithm.DijkstraAlgorithm;this.graph=graph};crow.algorithm.DijkstraAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.DijkstraAlgorithm.prototype.findPath=function(start,goal,opts){crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);this.visitedList=[];this.start=start;this.goal=goal;this.opts=opts||{};if(opts.limit)throw new Error("Dijkstra's doesn't support the `limit` option.");this.actor=opts.actor;this._getWrapperNode(start).distance=0;var endNode,found;if(typeof goal==="function"){this.mainLoop(start);endNode=this.determineClosestEndNode(goal);found=!!endNode}else{found=
this.mainLoop(start,goal);endNode=this._getWrapperNode(goal)}var path=[];if(endNode.distance<Infinity){path.unshift(endNode.innerNode);var node=endNode.previous;while(node){path.unshift(node.innerNode);node=node.previous}}return new crow.algorithm.Path({nodes:path,start:start,goal:goal,end:found?endNode.innerNode:null,length:found?endNode.distance:Infinity,found:found,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,actor:this.actor})};
crow.algorithm.DijkstraAlgorithm.prototype.determineClosestEndNode=function(goal){var closest,closestDistance=Infinity;for(var i=0;i<this.visitedList.length;i++){var node=this.visitedList[i];if(goal.call(node.innerNode)){var d=node.distance;if(d<closestDistance){closest=node;closestDistance=d}}}return closest};
crow.algorithm.DijkstraAlgorithm.prototype.mainLoop=function(node,endNode){var nextNodes=new crow.Algorithm.PriorityQueue;node=this._getWrapperNode(node);while(node!=null){var neighbors=node.innerNode.getNeighbors(this.graph);for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(neighbor.visited)continue;var neighborDistanceThroughMe=node.distance+node.innerNode.distanceToNeighbor(neighbor.innerNode,this.actor);var currentNeighborDistance=neighbor.distance;if(neighborDistanceThroughMe<
currentNeighborDistance){neighbor.distance=neighborDistanceThroughMe;neighbor.previous=node;currentNeighborDistance=neighborDistanceThroughMe}if(currentNeighborDistance<Infinity)nextNodes.enqueue(currentNeighborDistance,neighbor)}node.visited=true;this.visitedList.push(node);if(node.innerNode===endNode)return true;node=nextNodes.dequeue()}return false};crow.algorithm.DijkstraAlgorithm.WrapperNode=function(node){this.innerNode=node;this.visited=false;this.previous=null;this.distance=Infinity};
crow.algorithm.DijkstraAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.DijkstraAlgorithm.WrapperNode);crow.algorithm.DijkstraAlgorithm.attributes={min_speed:-2,moving_start:false,moving_goal:false,unstable_graph:false,heuristics_allowed:false,goal_is_node:true,goal_is_callback:true};crow.algorithm.DijkstraAlgorithm["alias"]="dijkstra";crow.Graph.registerAlgorithm(crow.algorithm.DijkstraAlgorithm);goog.provide("crow.algorithm.FRAStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.Graph");crow.algorithm.FRAStarAlgorithm=function(graph){this.klass=crow.algorithm.FRAStarAlgorithm;this.graph=graph};crow.algorithm.FRAStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.FRAStarAlgorithm.prototype._invalidatePoint=function(path,invalidationEvent){crow.Algorithm.prototype._invalidatePoint.apply(this,arguments);this.reset()};
crow.algorithm.FRAStarAlgorithm.prototype.reset=function(){this.wrapperNode=new crow.Algorithm.NodeMap;this.start=this._getWrapperNode(this.start.innerNode);this.goal=this._getWrapperNode(this.goal.innerNode);this.iteration=1;this.start.initialize();this.start.g=0;this.evaluatedList=[];this.openSet=new crow.structs.BucketPriorityQueue;this.openSet.enqueue(0,this.start);this.state=1};crow.algorithm.FRAStarAlgorithm.prototype.ComputePriority=function(node){return node.g+node.innerNode.distanceToGoal(this.goal.innerNode)};
crow.algorithm.FRAStarAlgorithm.prototype.TestClosedList=function(node){return node==this.start||!!(node.expanded&&node.parent)};
crow.algorithm.FRAStarAlgorithm.prototype.ComputeShortestPath=function(){while(node=this.openSet.dequeue()){if(node.expanded)continue;node.expanded=true;var neighbors=node.innerNode.getNeighbors(this.graph,this.neighbors);for(var n=0;n<neighbors.length;n++){var neighbor=this._getWrapperNode(neighbors[n]);if(!this.TestClosedList(neighbor)){neighbor.initialize();var newG=node.g+node.innerNode.distanceToNeighbor(neighbor.innerNode);if(newG<neighbor.g){neighbor.g=newG;neighbor.parent=node;this.openSet.enqueue(this.ComputePriority(neighbor),
neighbor)}}}if(node==this.goal)return true}return false};
crow.algorithm.FRAStarAlgorithm.prototype.UpdateParent=function(clockwise){var node=this.cell;var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);if(!clockwise)neighbors=neighbors.reverse();var parent=node.parent;var index=-1;for(var i=0;i<neighbors.length;i++)if(neighbors[i]==parent){index=i;break}if(index>=0)for(var i=0;i<neighbors.length;i++){var j=(i+index)%neighbors.length;var neighbor=this._getWrapperNode(neighbors[j]);if(neighbor.g==node.g+node.innerNode.distanceToNeighbor(neighbor.innerNode)&&
this.TestClosedList(neighbor)){neighbor.parent=node;this.cell=neighbor;return true}}return false};crow.algorithm.FRAStarAlgorithm.prototype.Step2=function(){this.cell=this.start;while(this.UpdateParent(false));this.cell=this.start;while(this.UpdateParent(true));};
crow.algorithm.FRAStarAlgorithm.prototype.Step3=function(){this.start.parent=null;var newStart=this.start,oldStart=this.previousStart;var bfs=new crow.algorithm.BFSBasicAlgorithm(this.graph);var getWrapper=this._getWrapperNode;var algo=this;var nodes=bfs.search(this.previousStart.innerNode,{filter:function(node){var a=getWrapper.call(algo,node).ancestors();return a.indexOf(oldStart)>=0&&a.indexOf(newStart)<0}});for(var i=0;i<nodes.length;i++){var node=this._getWrapperNode(nodes[i]);node.parent=null;
this.openSet.remove(node)}};
crow.algorithm.FRAStarAlgorithm.prototype.FindPerimeter=function(startNode,includingNode){var perimeter=[includingNode];var neighbors=startNode.innerNode.getNeighbors(this.graph,this.diagonals,true);var i;for(i=0;i<neighbors.length;i++){var neighbor=neighbors[i];if(neighbor==includingNode.innerNode)break}var node=startNode;for(var j=0;j<neighbors.length;j++){var k=(i+j)%neighbors.length;var neighbor=neighbors[k];if(neighbor){neighbor=this._getWrapperNode(neighbor);if(!this.TestClosedList(neighbor)){if(perimeter[perimeter.length-1]!=
neighbor)perimeter.push(neighbor)}else if(neighbor==startNode)break;else{node=neighbor;neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals,true);i=k+3;j=-1}}}return perimeter};
crow.algorithm.FRAStarAlgorithm.prototype.Step5=function(){var perimeter=this.FindPerimeter(this.start,this.anchor);for(var i=0;i<perimeter.length;i++){var pNode=perimeter[i];this.openSet.enqueue(this.ComputePriority(pNode),pNode)}var initCell=this.InitializeCell;var algo=this;this.openSet.each(function(node){node.initialize()});var newNodes=[];this.openSet.each(function(node){var neighbors=node.innerNode.getNeighbors(algo.graph,algo.diagonals);for(var i=0;i<neighbors.length;i++){var neighbor=algo._getWrapperNode(neighbors[i]);
var newG=neighbor.g+neighbor.innerNode.distanceToNeighbor(node.innerNode);if(algo.TestClosedList(neighbor)&&node.g>newG){node.g=newG;node.parent=neighbor;newNodes.push(node)}}});for(var i=0;i<newNodes.length;i++){var node=newNodes[i];this.openSet.enqueue(this.ComputePriority(node),node)}};
crow.algorithm.FRAStarAlgorithm.prototype.findPath=function(start,goal,opts){if(!opts)opts={};crow.algorithm.ShortestPathAlgorithm.prototype.findPath.apply(this,arguments);start=this._getWrapperNode(start);goal=this._getWrapperNode(goal);this.start=start;this.goal=goal;this.opts=opts;this.reset();var path=this.resolveResults(this.opts,false);this.continueCalculating(path);return path};
crow.algorithm.FRAStarAlgorithm.prototype.resolveResults=function(opts,found){if(!opts)opts={};var pathOpts;if(found){var nodes=this.goal.ancestors(true).concat(this.goal.innerNode);pathOpts={nodes:nodes,start:this.start.innerNode,goal:this.goal.innerNode,found:true,length:this.goal.g,algorithm:this,graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined",actor:opts.actor}}else pathOpts={nodes:[],start:this.start.innerNode,goal:this.goal.innerNode,found:false,length:Infinity,algorithm:this,
graph:opts.graph,baked:opts.baked||typeof opts.baked==="undefined",actor:opts.actor};return new crow.algorithm.Path(pathOpts)};
crow.algorithm.FRAStarAlgorithm.prototype.updateStart=function(path){var foundStart=false;for(var i=0;i<path.nodes.length;i++)if(path.nodes[i]==this.start.innerNode){path.nodes.splice(0,i);foundStart=true;break}if(foundStart){var length=0;for(var i=0;i<path.nodes.length-1;i++)length+=path.nodes[i].distanceToNeighbor(path.nodes[i+1]);path.length=length}else throw new Error("Present (start) position not found on path!  FRA* only works if this agent follows the path towards the target.");};
crow.algorithm.FRAStarAlgorithm.prototype.continueCalculating=function(path){this.start=this._getWrapperNode(this.start);this.goal=this._getWrapperNode(this.goal);if(this.previousStart)this.previousStart=this._getWrapperNode(this.previousStart);if(this.previousGoal)this.previousGoal=this._getWrapperNode(this.previousGoal);while(true)switch(this.state){case 1:if(this.start==this.goal)this.state=true;else{var found=this.ComputeShortestPath();var newPath=this.resolveResults(null,found);path.found=found;
path.nodes=newPath.nodes;path.length=this.goal.g;if(found){this.openListIncomplete=false;this.state=3}else this.state=false}break;case 3:if(this.TestClosedList(this.goal))this.state=4;else this.state=5;break;case 4:var onPath=false;if(this.start!=this.goal)for(var i=0;i<path.nodes.length;i++){var node=path.nodes[i];if(node==this.goal.innerNode){this.updateStart(path);return true}}if(this.start==this.goal)this.state=true;else{if(this.newTarget){this.previousGoal=this.goal;this.goal=this._getWrapperNode(this.newTarget);
this.newTarget=null}if(!this.previousStart)this.previousStart=this.start;if(this.start!=this.previousStart){this.Step2();this.anchor=this.start.parent;this.Step3();this.openListIncomplete=true}this.state=3}break;case 5:if(this.openListIncomplete){this.iteration++;this.Step5()}this.state=1;break;case true:path.found=true;path.nodes=[path.goal];path.length=0;return true;case false:path.found=false;path.nodes=[];path.length=Infinity;return false}};
crow.algorithm.FRAStarAlgorithm.prototype.moveStart=function(path,newStart){this.previousStart=this.start;this.start=newStart};crow.algorithm.FRAStarAlgorithm.prototype.moveTarget=function(path,newTarget){this.previousGoal=this.goal;this.goal=newTarget};crow.algorithm.FRAStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.generatedIteration=0;this.expanded=false;this.g=null;this.parent=null};crow.algorithm.FRAStarAlgorithm.prototype._getWrapperNode=crow.Algorithm.wrapperNodeGetterTemplate(crow.algorithm.FRAStarAlgorithm.WrapperNode);
crow.algorithm.FRAStarAlgorithm.WrapperNode.prototype.initialize=function(){var algoIteration=this.algorithm.iteration;if(this.generatedIteration!=algoIteration){this.g=Infinity;this.generatedIteration=algoIteration;this.expanded=false}};crow.algorithm.FRAStarAlgorithm.WrapperNode.prototype.ancestors=function(useRawNodes){var ancestors=[];var p=this.parent;while(p){ancestors.unshift(useRawNodes?p.innerNode:p);p=p.parent}return ancestors};
crow.algorithm.FRAStarAlgorithm.attributes={min_speed:2,moving_start:true,moving_goal:true,unstable_graph:false,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};crow.algorithm.FRAStarAlgorithm["alias"]="fra*";crow.Graph.registerAlgorithm(crow.algorithm.FRAStarAlgorithm);goog.provide("crow.algorithm.LinearAlgorithm");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.Graph");crow.algorithm.LinearAlgorithm=function(graph){this.klass=crow.algorithm.LinearAlgorithm;this.graph=graph};crow.algorithm.LinearAlgorithm.prototype=new crow.algorithm.SearchAlgorithm;
crow.algorithm.LinearAlgorithm.prototype.search=function(start,opts){if(!opts)opts={};var list;var nodes=this.graph.getNodes();if(opts.filter){list=[];for(var i=0;i<nodes.length;i++){var n=nodes[i];if(opts.filter.call(n))list.push(n)}}else list=nodes;return list};crow.algorithm.LinearAlgorithm["alias"]="linear";crow.Graph.registerAlgorithm(crow.algorithm.LinearAlgorithm);goog.provide("crow.structs.NDArray");goog.require("crow.util.Assert");crow.structs.NDArray=function(dimensions){this.arr=[];this.dimensions=dimensions};
crow.structs.NDArray.prototype.add=function(value){if(arguments.length-1!=this.dimensions)throw new Error(crow.assert.IncorrectArgumentCount(arguments.length,this.dimensions+1));var parentArray=this.arr,array=parentArray,l=arguments.length;for(var i=1;i<l-1;i++){array=parentArray[arguments[i]];if(typeof array==="undefined")array=parentArray[arguments[i]]=[];parentArray=array}array[arguments[l-1]]=value};
crow.structs.NDArray.prototype.get=function(){if(arguments.length!=this.dimensions)throw new crow.assert.IncorrectArgumentCount(arguments.length,this.dimensions);var arr=this.arr;for(var i=0;i<arguments.length&&typeof arr!=="undefined";i++)arr=arr[arguments[i]];return arr};crow.structs.NDArray.prototype.each=function(callback){for(var i=0;i<this.arr.length;i++){var el=this.arr[i];if(typeof el!=="undefined")this._each(callback,el,[i])}};
crow.structs.NDArray.prototype._each=function(callback,arr,path){if(arr instanceof Array&&path.length<=this.dimensions)for(var i=0;i<arr.length;i++){var newPath=path.slice(0).concat(i);var el=arr[i];if(typeof el!=="undefined")this._each(callback,el,newPath)}else{var args=path;args.unshift(arr);callback.apply(this,args)}};goog.provide("crow.algorithm.LPAStarAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.algorithm.Path");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.structs.NDArray");goog.require("crow.Graph");crow.algorithm.LPAStarAlgorithm=function(graph){this.klass=crow.algorithm.LPAStarAlgorithm;this.graph=graph};crow.algorithm.LPAStarAlgorithm.prototype=new crow.algorithm.ShortestPathAlgorithm;
crow.algorithm.LPAStarAlgorithm.prototype._CalculateKey=function(node){var startDist=Math.min(node.g,node.rhs);return[startDist+node.innerNode.distanceToGoal(this.goal.innerNode),startDist]};
crow.algorithm.LPAStarAlgorithm.prototype._UpdateVertex=function(node){if(node!=this.start){var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);var bestScore=Infinity;for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);var score=neighbor.g+node.innerNode.distanceToNeighbor(neighbor.innerNode);if(score<bestScore)bestScore=score}node.rhs=bestScore}this.U.remove(node);if(node.g!=node.rhs)this.U.enqueue(this._CalculateKey(node),node)};
crow.algorithm.LPAStarAlgorithm.prototype.keyComp=function(k1,k2){if(k1[0]<k2[0]||k1[0]==k2[0]&&k1[1]<k2[1])return-1;if(k1[0]==k2[0]&&k1[1]==k2[1])return 0;return 1};crow.algorithm.LPAStarAlgorithm.prototype.updateNeighbors=function(node){var neighbors=node.innerNode.getNeighbors(this.graph,this.diagonals);for(var i=0;i<neighbors.length;i++)this._UpdateVertex(this._getWrapperNode(neighbors[i]))};crow.algorithm.LPAStarAlgorithm.prototype.debugGraph=function(){};
crow.algorithm.LPAStarAlgorithm.prototype.findPath=function(start,goal,opts){if(typeof goal==="function")throw new Error("LPA* doesn't support using a callback to determine the goal");if(!opts)opts={};this._wrapperNode=new crow.Algorithm.NodeMap;this.start=this._getWrapperNode(start);this.goal=this._getWrapperNode(goal);this.diagonals=opts.diagonals;this.U=new crow.structs.BucketPriorityQueue(this.keyComp);this.start.rhs=0;this.U.enqueue(this._CalculateKey(this.start),this.start);this.mainLoop();
var results=this.resolveResults();var pathOpts={nodes:results.nodes,start:this.start.innerNode,goal:this.goal.innerNode,found:results.found,length:results.length,recalculate:this.recalculate,algorithm:this,baked:opts.baked||typeof opts.baked==="undefined"&&!opts.limit,graph:opts.graph};return new crow.algorithm.Path(pathOpts)};
crow.algorithm.LPAStarAlgorithm.prototype.mainLoop=function(){while(this.U.length&&(this.keyComp(this.U.peekKey(),this._CalculateKey(this.goal))<0||this.goal.rhs!=this.goal.g)){var u=this.U.dequeue();if(u.g>u.rhs){u.g=u.rhs;this.updateNeighbors(u)}else{u.g=Infinity;this.updateNeighbors(u);this._UpdateVertex(u)}}};
crow.algorithm.LPAStarAlgorithm.prototype.resolveResults=function(){var nodes=[];var current=this.goal;var length=0;var failsafeMaximum=Infinity,count=0;if(this.graph)failSafeMaximum=this.graph.width*this.graph.height;while(current!=this.start&&current){nodes.unshift(current.innerNode);var neighbors=current.innerNode.getNeighbors(this.graph,this.diagonals);var bestScore=Infinity,bestNeighbor=null,distance=0,bestDistance=0;for(var i=0;i<neighbors.length;i++){var neighbor=this._getWrapperNode(neighbors[i]);
distance=current.innerNode.distanceToNeighbor(neighbor.innerNode);var score=neighbor.g+distance;if(score<bestScore){bestScore=score;bestNeighbor=neighbor;bestDistance=distance}}current=bestNeighbor;if(bestNeighbor)length+=bestDistance;count++;if(count>=failsafeMaximum){throw new Error("resolveResults won't terminate");break}}var found=current==this.start;if(!found)nodes=[];nodes.unshift(this.start.innerNode);return{nodes:nodes,length:length,found:found}};
crow.algorithm.LPAStarAlgorithm.prototype.recalculate=function(){var a=this.algorithm;return a.findPath(a.start,a.goal,a.opts)};
crow.algorithm.LPAStarAlgorithm.prototype._invalidatePoint=function(path,invalidationEvent){var x=invalidationEvent.x,y=invalidationEvent.y;if(!path.invalidatedPoints)path.invalidatedPoints=new crow.structs.NDArray(2);path.invalidatedPoints.add(true,x,y);var node=path.graph.getNode(x,y,true);var neighbors=node.getNeighbors(path.graph,path.algorithm.diagonals);for(var i=0;i<neighbors.length;i++){var neighbor=neighbors[i];path.invalidatedPoints.add(true,neighbor.x,neighbor.y)}path.found=false};
crow.algorithm.LPAStarAlgorithm.prototype.continueCalculating=function(path){if(path.invalidatedPoints){var algo=this;var getWrapperNode=this._getWrapperNode;path.invalidatedPoints.each(function(val,x,y){var n=algo.graph.getNode(x,y);if(n)algo._UpdateVertex(getWrapperNode.call(algo,n))});this.mainLoop();path.invalidatedPoints=new crow.structs.NDArray(2);var results=this.resolveResults();path.nodes=results.nodes;path.length=results.length;path.found=results.found}return path.found};
crow.algorithm.LPAStarAlgorithm.prototype._getWrapperNode=function(node){var w=this._wrapperNode.get(node);if(w)return w;w=new crow.algorithm.LPAStarAlgorithm.WrapperNode(node);this._wrapperNode.set(node,w);return w};crow.algorithm.LPAStarAlgorithm.WrapperNode=function(node){this.innerNode=node;this.rhs=Infinity;this.g=Infinity};crow.algorithm.LPAStarAlgorithm.attributes={min_speed:0,moving_start:false,moving_goal:false,unstable_graph:true,heuristics_allowed:true,goal_is_node:true,goal_is_callback:false};
crow.algorithm.LPAStarAlgorithm["alias"]="lpa*";crow.Graph.registerAlgorithm(crow.algorithm.LPAStarAlgorithm);goog.provide("crow.ConnectedNode");goog.require("crow.Node");crow.ConnectedNode=function(id){crow.Node.apply(this,arguments);this.connections=[];this.connectionDistances={}};crow.ConnectedNode.prototype=new crow.Node;
crow.ConnectedNode.prototype.connectTo=function(otherNode,distance,symmetric){if(typeof distance=="undefined")distance=1;this.connections.push(otherNode);this.connectionDistances[otherNode.id]=distance;if(typeof symmetric!=="false"&&otherNode instanceof crow.ConnectedNode){otherNode.connections.push(this);otherNode.connectionDistances[this.id]=distance}};crow.ConnectedNode.prototype.getNeighbors=function(){return this.connections};
crow.ConnectedNode.prototype.distanceToNeighbor=function(otherNode){return this.connectionDistances[otherNode.id]||Infinity};goog.provide("crow.All");goog.require("crow.util.MonkeyPatches");goog.require("crow.Logger");goog.require("crow.Graph");goog.require("crow.Algorithm");goog.require("crow.AlgorithmResolver");goog.require("crow.algorithm.AStarAlgorithm");goog.require("crow.algorithm.BasicTraversalAlgorithm");goog.require("crow.algorithm.BFSAlgorithm");goog.require("crow.algorithm.BFSBasicAlgorithm");goog.require("crow.algorithm.DFSAlgorithm");goog.require("crow.algorithm.DijkstraAlgorithm");goog.require("crow.algorithm.FRAStarAlgorithm");
goog.require("crow.algorithm.LinearAlgorithm");goog.require("crow.algorithm.LPAStarAlgorithm");goog.require("crow.algorithm.SearchAlgorithm");goog.require("crow.algorithm.ShortestPathAlgorithm");goog.require("crow.BaseNode");goog.require("crow.ConnectedNode");goog.require("crow.GridNode");goog.require("crow.structs.BucketPriorityQueue");goog.require("crow.structs.NDArray");
